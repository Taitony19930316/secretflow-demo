# PSI

> Private Set Intersection - è®©æ•°æ®åœ¨éšç§ä¿æŠ¤ä¸‹äº§ç”Ÿä»·å€¼

---

## åœºæ™¯ç—›ç‚¹

### æ•°æ®æµé€šçš„æ ¹æœ¬å›°å¢ƒ

åœ¨æ•°å­—ç»æµæ—¶ä»£ï¼Œ**æ•°æ®åªæœ‰æµé€šæ‰èƒ½äº§ç”Ÿä»·å€¼**ã€‚ä½†æ•°æ®æµé€šé¢ä¸´ç€ä¸å¯è°ƒå’Œçš„çŸ›ç›¾ï¼š

#### ä»·å€¼åˆ›é€ çš„éœ€æ±‚

- **è·¨ç»„ç»‡åä½œ**ï¼šå¤šæ–¹æ•°æ®è”åˆæ‰èƒ½äº§ç”Ÿæ›´å¤§ä»·å€¼
- **æå‡å†³ç­–è´¨é‡**ï¼šæ›´å…¨é¢çš„æ•°æ®å¸¦æ¥æ›´å‡†ç¡®çš„æ´å¯Ÿ
- **ä¼˜åŒ–èµ„æºé…ç½®**ï¼šæ•°æ®å…±äº«å¯ä»¥å‡å°‘é‡å¤å’Œæµªè´¹

#### éšç§ä¿æŠ¤çš„åˆšéœ€

- **æ³•è§„å¼ºåˆ¶**ï¼šæ•°æ®å®‰å…¨æ³•ã€ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ç­‰ä¸¥æ ¼ç›‘ç®¡
- **å•†ä¸šæœºå¯†**ï¼šä¼ä¸šæ ¸å¿ƒèµ„äº§ä¸èƒ½å¤–æ³„
- **ä¸ªäººæƒåˆ©**ï¼šå…¬æ°‘éšç§æƒå—æ³•å¾‹ä¿æŠ¤

#### ä¼ ç»Ÿæ–¹æ¡ˆçš„æ ¹æœ¬ç¼ºé™·

| æ–¹æ¡ˆ | æœ¬è´¨é—®é¢˜ | ç»“æœ |
|------|---------|------|
| **æ˜æ–‡äº¤æ¢** | æ•°æ®å®Œå…¨æš´éœ² | âŒ éšç§å…¨å¤±ï¼Œè¿æ³•è¿è§„ |
| **ä¸­å¿ƒåŒ–ç¬¬ä¸‰æ–¹** | ä¿¡ä»»é£é™©è½¬ç§» | âš ï¸ æ— æ³•è§£å†³ä¿¡ä»»é—®é¢˜ |
| **ä¸æµé€š** | æ•°æ®å­¤å²› | ğŸ“‰ ä»·å€¼æ— æ³•é‡Šæ”¾ |

#### æ ¸å¿ƒçŸ›ç›¾

```
æ•°æ®ä»·å€¼ â‡„ éšç§ä¿æŠ¤
   â†“
 ä¸å¯å…¼å¾—ï¼Ÿ
   â†“
PSI æŠ€æœ¯ç ´è§£å›°å±€
```

**æœ¬è´¨é—®é¢˜ï¼š**
- **æƒ³è¦ï¼š** è®¡ç®—ç»“æœï¼ˆå¦‚äº¤é›†ã€ç»Ÿè®¡å€¼ï¼‰
- **ä¸èƒ½ï¼š** æ³„éœ²åŸå§‹æ•°æ®
- **ä¼ ç»ŸæŠ€æœ¯ï¼š** äºŒé€‰ä¸€ï¼Œæ— æ³•å…¼å¾—
- **PSI æ–¹æ¡ˆï¼š** é±¼å’Œç†ŠæŒå¯ä»¥å…¼å¾—

---

## æŠ€æœ¯åŸç†

### ä»€ä¹ˆæ˜¯ PSIï¼Ÿ

PSIï¼ˆPrivate Set Intersectionï¼Œéšç§æ±‚äº¤ï¼‰å…è®¸å¤šæ–¹åœ¨**ä¸æ³„éœ²å„è‡ªæ•°æ®**çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—å‡ºæ•°æ®é›†çš„**äº¤é›†**ã€‚

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- **æ•°æ®å¯ç”¨ä¸å¯è§**ï¼šå¯ä»¥è®¡ç®—äº¤é›†ï¼Œä½†çœ‹ä¸åˆ°å¯¹æ–¹çš„å®Œæ•´æ•°æ®
- **åªæŠ«éœ²äº¤é›†**ï¼šåŒæ–¹åªçŸ¥é“äº¤é›†ç»“æœï¼Œä¸çŸ¥é“å¯¹æ–¹çš„å…¶ä»–æ•°æ®
- **åŠ å¯†çŠ¶æ€è®¡ç®—**ï¼šåŸå§‹æ•°æ®åœ¨åŠ å¯†çŠ¶æ€ä¸‹è®¡ç®—ï¼Œä¸ä¼šæ˜æ–‡ä¼ è¾“

### PSI å·¥ä½œæµç¨‹ï¼ˆ5æ­¥ï¼‰

#### æ­¥éª¤1ï¼šæ•°æ®å‡†å¤‡

åŒæ–¹å„è‡ªæŒæœ‰è‡ªå·±çš„æ•°æ®é›†ï¼š
- å‚ä¸æ–¹ Aï¼š`[1001, 1002, 1003, 1005, 1007]`
- å‚ä¸æ–¹ Bï¼š`[1002, 1003, 1004, 1006, 1008]`

#### æ­¥éª¤2ï¼šæœ¬åœ°åŠ å¯†

å„æ–¹ä½¿ç”¨**æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰**å¯¹è‡ªå·±çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼š
```
1001 â†’ å“ˆå¸Œ â†’ cd6357efdd966de8c0cb...
1002 â†’ å“ˆå¸Œ â†’ 8277e091c4d5fa23eb1c...
1003 â†’ å“ˆå¸Œ â†’ e2d0fe19ab5c8d9f3e67...
```

**å…³é”®**ï¼šåŸå§‹æ•°æ®ä¸ä¼šå‘é€ç»™å¯¹æ–¹ï¼

#### æ­¥éª¤3ï¼šäº¤æ¢å¯†æ–‡

åŒæ–¹äº¤æ¢**åŠ å¯†åçš„æ•°æ®**ï¼ˆä¸æ˜¯åŸå§‹æ•°æ®ï¼‰ï¼š
- ä¼ è¾“çš„éƒ½æ˜¯å“ˆå¸Œå€¼
- æ— æ³•åæ¨åŸå§‹æ•°æ®

#### æ­¥éª¤4ï¼šè®¡ç®—äº¤é›†

å¯¹æ¯”åŠ å¯†åçš„æ•°æ®ï¼Œæ‰¾å‡ºç›¸åŒçš„å“ˆå¸Œå€¼ï¼š
- åªæœ‰ç›¸åŒçš„åŸå§‹æ•°æ®æ‰ä¼šäº§ç”Ÿç›¸åŒçš„å“ˆå¸Œ
- æ‰¾åˆ°åŒ¹é…çš„å“ˆå¸Œ â†’ æ‰¾åˆ°äº¤é›†

#### æ­¥éª¤5ï¼šè¿”å›ç»“æœ

è§£å¯†äº¤é›†ç»“æœï¼š`[1002, 1003]`
- åŒæ–¹çŸ¥é“ï¼šäº¤é›†æ˜¯ `[1002, 1003]`
- åŒæ–¹ä¸çŸ¥é“ï¼šå¯¹æ–¹çš„å…¶ä»–æ•°æ®

### éšç§ä¿æŠ¤çš„æ ¸å¿ƒ

#### å‚ä¸æ–¹ A çš„è§†è§’

**çŸ¥é“ï¼š**
- è‡ªå·±çš„å®Œæ•´æ•°æ®ï¼š`[1001, 1002, 1003, 1005, 1007]`
- äº¤é›†ç»“æœï¼š`[1002, 1003]`

**ä¸çŸ¥é“ï¼š**
- å‚ä¸æ–¹ B çš„å…¶ä»–æ•°æ®ï¼š`1004, 1006, 1008`
- å‚ä¸æ–¹ B æœ‰å¤šå°‘æ•°æ®

#### å‚ä¸æ–¹ B çš„è§†è§’

**çŸ¥é“ï¼š**
- è‡ªå·±çš„å®Œæ•´æ•°æ®ï¼š`[1002, 1003, 1004, 1006, 1008]`
- äº¤é›†ç»“æœï¼š`[1002, 1003]`

**ä¸çŸ¥é“ï¼š**
- å‚ä¸æ–¹ A çš„å…¶ä»–æ•°æ®ï¼š`1001, 1005, 1007`
- å‚ä¸æ–¹ A æœ‰å¤šå°‘æ•°æ®

---

## åœ¨çº¿äº¤äº’æ¼”ç¤º

::: tip æ“ä½œæç¤º
ä¸‹æ–¹æ¼”ç¤ºå¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸Šè¿è¡Œï¼Œå°è¯•ä¿®æ”¹æ•°æ®çœ‹çœ‹æ•ˆæœï¼
:::

<div id="psi-demo" style="padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; margin: 30px 0; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
  <h3 style="color: white; margin-top: 0; font-size: 24px;">PSI æ¼”ç¤º</h3>
  <div style="background: white; padding: 20px; border-radius: 8px; margin: 15px 0;">
    <div style="margin-bottom: 20px;">
      <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #667eea;">å‚ä¸æ–¹ A çš„æ•°æ®ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼š</label>
      <input type="text" id="hospital-a" value="1001,1002,1003,1005,1007" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #667eea; border-radius: 6px; box-sizing: border-box;" />
    </div>
    <div style="margin-bottom: 20px;">
      <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #764ba2;">å‚ä¸æ–¹ B çš„æ•°æ®ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼š</label>
      <input type="text" id="hospital-b" value="1002,1003,1004,1006,1008" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #764ba2; border-radius: 6px; box-sizing: border-box;" />
    </div>
    <button onclick="runPSI()" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">ğŸ”’ è®¡ç®—éšç§äº¤é›†</button>
  </div>
  <div id="psi-result" style="display:none; background: white; padding: 20px; border-radius: 8px; margin-top: 15px; animation: fadeIn 0.5s;">
    <h4 style="color: #667eea; margin-top: 0; font-size: 20px;">PSI è®¡ç®—å®Œæˆ</h4>
    <div id="intersection-result" style="padding: 15px; background: #f0f4ff; border-left: 4px solid #667eea; margin: 15px 0; border-radius: 4px; font-size: 16px; color: #333;"></div>
    <div id="count-result" style="padding: 15px; background: #f0f4ff; border-left: 4px solid #764ba2; margin: 15px 0; border-radius: 4px; font-size: 16px; color: #333;"></div>
    <div style="padding: 20px; background: #fff8e1; border-left: 5px solid #ff9800; border-radius: 8px; font-size: 16px; color: #333; line-height: 1.8;">
      <strong style="font-size: 17px; color: #e65100;">éšç§ä¿æŠ¤è¯´æ˜ï¼š</strong><br />
      <div style="margin-top: 10px;">
      â€¢ å‚ä¸æ–¹ A ä¸çŸ¥é“å‚ä¸æ–¹ B çš„å®Œæ•´æ•°æ®åˆ—è¡¨<br />
      â€¢ å‚ä¸æ–¹ B ä¸çŸ¥é“å‚ä¸æ–¹ A çš„å®Œæ•´æ•°æ®åˆ—è¡¨<br />
      â€¢ åŒæ–¹åªçŸ¥é“äº¤é›†ç»“æœ<br />
      â€¢ æ•°æ®åœ¨åŠ å¯†çŠ¶æ€ä¸‹è®¡ç®—
      </div>
    </div>
    <div id="hash-details" style="margin-top: 15px; padding: 20px; background: #e8f5e9; border-radius: 8px; border-left: 5px solid #4caf50;">
      <strong style="font-size: 17px; color: #2e7d32;">åŠ å¯†è¿‡ç¨‹ï¼ˆSHA-256 å“ˆå¸Œï¼‰ï¼š</strong>
      <div id="hash-content" style="margin-top: 15px; font-size: 15px; color: #333; line-height: 1.8; font-family: 'Courier New', Consolas, monospace; max-height: 300px; overflow-y: auto;"></div>
    </div>
  </div>
</div>

<script>
if (typeof window !== 'undefined') {
  // SHA-256 å“ˆå¸Œå‡½æ•°
  async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  // è¿è¡Œ PSIï¼ˆæŒ‚è½½åˆ°å…¨å±€ï¼‰
  window.runPSI = async function() {
    const button = event.target;
    button.textContent = 'â³ è®¡ç®—ä¸­...';
    button.disabled = true;

    // è·å–è¾“å…¥
    const hospitalAInput = document.getElementById('hospital-a').value;
    const hospitalBInput = document.getElementById('hospital-b').value;
    const hospitalA = hospitalAInput.split(',').map(x => x.trim()).filter(x => x);
    const hospitalB = hospitalBInput.split(',').map(x => x.trim()).filter(x => x);

    // æ¨¡æ‹ŸåŠ å¯†è¿‡ç¨‹ï¼ˆæ˜¾ç¤ºå“ˆå¸Œï¼‰
    const hashedA = await Promise.all(hospitalA.map(id => sha256(id)));
    const hashedB = await Promise.all(hospitalB.map(id => sha256(id)));

    // è®¡ç®—äº¤é›†
    const intersection = [];
    const hashMap = new Map();
    for (let i = 0; i < hospitalA.length; i++) {
      hashMap.set(hashedA[i], hospitalA[i]);
    }
    for (let i = 0; i < hospitalB.length; i++) {
      if (hashMap.has(hashedB[i])) {
        intersection.push(hospitalB[i]);
      }
    }

    // æ˜¾ç¤ºç»“æœ
    document.getElementById('intersection-result').innerHTML =
      `<strong style="color: #667eea;">å…±åŒæ‚£è€… IDï¼š</strong><span style="font-size: 20px; font-weight: bold; color: #764ba2;">[${intersection.join(', ')}]</span>`;
    document.getElementById('count-result').innerHTML =
      `<strong style="color: #764ba2;">å…±åŒæ‚£è€…æ•°é‡ï¼š</strong><span style="font-size: 20px; font-weight: bold; color: #667eea;">${intersection.length}</span>`;

    // æ˜¾ç¤ºåŠ å¯†ç»†èŠ‚
    let hashDetails = '<div style="color: #2e7d32; font-weight: bold; margin-bottom: 12px; font-size: 16px;">å‚ä¸æ–¹ A çš„å“ˆå¸Œå€¼ï¼š</div>';
    hospitalA.slice(0, 3).forEach((id, i) => {
      hashDetails += `<div style="margin: 8px 0; padding: 8px; background: #f1f8f4; border-radius: 4px; color: #333; font-size: 14px;">
        <span style="color: #1976d2; font-weight: bold;">${id}</span>
        <span style="color: #666;">â†’</span>
        <span style="color: #388e3c; font-family: monospace;">${hashedA[i].substring(0, 24)}...</span>
      </div>`;
    });

    hashDetails += '<div style="color: #2e7d32; font-weight: bold; margin-top: 20px; margin-bottom: 12px; font-size: 16px;">å‚ä¸æ–¹ B çš„å“ˆå¸Œå€¼ï¼š</div>';
    hospitalB.slice(0, 3).forEach((id, i) => {
      hashDetails += `<div style="margin: 8px 0; padding: 8px; background: #f1f8f4; border-radius: 4px; color: #333; font-size: 14px;">
        <span style="color: #1976d2; font-weight: bold;">${id}</span>
        <span style="color: #666;">â†’</span>
        <span style="color: #388e3c; font-family: monospace;">${hashedB[i].substring(0, 24)}...</span>
      </div>`;
    });
    document.getElementById('hash-content').innerHTML = hashDetails;
    document.getElementById('psi-result').style.display = 'block';

    // æ¢å¤æŒ‰é’®
    button.textContent = 'ğŸ”’ è®¡ç®—éšç§äº¤é›†';
    button.disabled = false;
  }

  // æŒ‰é’®æ‚¬åœæ•ˆæœ
  document.addEventListener('DOMContentLoaded', function() {
    const button = document.querySelector('#psi-demo button');
    if (button) {
      button.addEventListener('mouseover', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 5px 20px rgba(102, 126, 234, 0.4)';
      });
      button.addEventListener('mouseout', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = 'none';
      });
    }
  });
}
</script>

<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

---

### æ·±å…¥å­¦ä¹ ï¼šçœŸå®çš„ SecretFlow PSI

ä¸Šæ–¹æ¼”ç¤ºä½¿ç”¨ Web Crypto API å®ç°äº†ç®€åŒ–ç‰ˆ PSIï¼Œå±•ç¤ºäº†æ ¸å¿ƒåŸç†ã€‚

**è¿è¡Œæ–¹å¼ï¼š**

<div style="background: #f5f7fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">

**ğŸ³ Docker è¿è¡Œï¼ˆæ¨èï¼‰**

```bash
# ä¸‹è½½ä»£ç 
curl -O https://paopaotai.github.io/secretflow-demo/psi-secretflow-final.py

# è¿è¡Œæ¼”ç¤º
docker run --rm -v $(pwd):/work secretflow/secretflow-lite-anolis8:latest \
  python3 /work/psi-secretflow-final.py
```

**ğŸ“¥ æˆ–è€…ï¼š**[ä¸‹è½½ä»£ç ](../../psi-secretflow-final.py) ååœ¨æœ¬åœ° Python 3.8+ ç¯å¢ƒè¿è¡Œ

</div>

#### ä»£ç ç¤ºä¾‹

<div style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">

```python
# SecretFlow PSI æ¼”ç¤º
# ç¬¬ä¸€æ­¥ï¼šå®‰è£… SecretFlowï¼ˆé¦–æ¬¡è¿è¡Œéœ€è¦å‡ åˆ†é’Ÿï¼‰
!pip install -q -U secretflow

import secretflow as sf
import pandas as pd

# åˆå§‹åŒ–åŒæ–¹ç¯å¢ƒ
sf.init(['alice', 'bob'], address='local', num_cpus=2, log_to_driver=False)
alice, bob = sf.PYU('alice'), sf.PYU('bob')

# å‡†å¤‡æ•°æ®ï¼šä¸¤å®¶åŒ»é™¢çš„æ‚£è€…ID
alice_data = pd.DataFrame({'patient_id': [f'P{i:04d}' for i in range(1, 501)]})
bob_data = pd.DataFrame({'patient_id': [f'P{i:04d}' for i in range(351, 951)]})

alice_data.to_csv('/tmp/alice.csv', index=False)
bob_data.to_csv('/tmp/bob.csv', index=False)

# æ‰§è¡ŒPSIï¼ˆä½¿ç”¨ECDHåè®®ï¼‰
from secretflow.security.aggregation import SPUAggregator

spu = sf.SPU(sf.utils.testing.cluster_def(['alice', 'bob']))
spu_agg = SPUAggregator(spu)

result = spu_agg.psi_join_csv(
    input_path={alice: '/tmp/alice.csv', bob: '/tmp/bob.csv'},
    output_path='/tmp/result.csv',
    receiver='alice',
    protocol='ECDH_PSI_2PC',
    keys=['patient_id']
)

# è¾“å‡ºç»“æœ
result_df = pd.read_csv('/tmp/result.csv')
print(f"åŒ»é™¢A: {len(alice_data)} åæ‚£è€…")
print(f"åŒ»é™¢B: {len(bob_data)} åæ‚£è€…")
print(f"å…±åŒæ‚£è€…: {len(result_df)} å")
print(f"å‰5ä¸ªäº¤é›†: {list(result_df['patient_id'].head())}")

sf.shutdown()
```

</div>

#### è¿è¡Œç»“æœ

```
åŒ»é™¢A: 500 åæ‚£è€…
åŒ»é™¢B: 600 åæ‚£è€…
å…±åŒæ‚£è€…: 150 å
å‰5ä¸ªäº¤é›†: ['P0351', 'P0352', 'P0353', 'P0354', 'P0355']
```

**æ ¸å¿ƒèƒ½åŠ›ä½“ç°ï¼š**
- âœ… ä½¿ç”¨ç”Ÿäº§çº§ ECDH-PSI åè®®
- âœ… SPUï¼ˆå®‰å…¨å¤„ç†å•å…ƒï¼‰æ”¯æŒåˆ†å¸ƒå¼è®¡ç®—
- âœ… 30è¡Œä»£ç å®Œæˆå®Œæ•´PSIæµç¨‹
- âœ… æ”¯æŒç™¾ä¸‡çº§æ•°æ®é›†ï¼Œæ€§èƒ½ä¼˜äºå¼€æºå®ç°

#### SecretFlow vs ä¼ ç»Ÿæ–¹æ¡ˆ

| å¯¹æ¯”ç»´åº¦ | ä¼ ç»Ÿå¼€æºPSI | SecretFlow PSI |
|---------|------------|---------------|
| **æ€§èƒ½** | ç™¾ä¸‡çº§æ•°æ® 30-60ç§’ | **ç™¾ä¸‡çº§æ•°æ® < 10ç§’** âš¡ |
| **åè®®** | å•ä¸€åè®®ï¼ˆé€šå¸¸ECDHï¼‰ | **å¤šåè®®è‡ªé€‚åº”**ï¼ˆECDH/KKRT/BC22ï¼‰|
| **è§„æ¨¡** | < 1000ä¸‡æ¡ | **æ”¯æŒäº¿çº§æ•°æ®** ğŸ“Š |
| **æ˜“ç”¨æ€§** | éœ€è¦å¯†ç å­¦çŸ¥è¯† | **pandasé£æ ¼API** ğŸ¯ |
| **ç”Ÿäº§éªŒè¯** | ç¤¾åŒºé¡¹ç›® | **èš‚èšé›†å›¢æ—¥å‡10äº¿+æ¡** ğŸ¢ |
| **å®¹é”™** | åŸºç¡€ | **æ–­ç‚¹ç»­ä¼ ã€å¼‚å¸¸æ¢å¤** ğŸ›¡ï¸ |
| **éƒ¨ç½²** | æ‰‹åŠ¨é…ç½® | **K8säº‘åŸç”Ÿæ”¯æŒ** â˜ï¸ |

**æŠ€æœ¯äº®ç‚¹ï¼š**

1. **åè®®ä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸­å›½ç½‘ç»œç¯å¢ƒä¼˜åŒ–ï¼Œå¸¦å®½åˆ©ç”¨ç‡æå‡40%
2. **å†…å­˜ç®¡ç†**ï¼šæµå¼å¤„ç†ï¼Œå†…å­˜å ç”¨é™ä½60%
3. **GPUåŠ é€Ÿ**ï¼šæ”¯æŒCUDAåŠ é€Ÿï¼Œæ€§èƒ½æå‡10-100å€
4. **å·¥ç¨‹åŒ–**ï¼šå®Œæ•´çš„ç›‘æ§ã€æ—¥å¿—ã€å®¡è®¡èƒ½åŠ›

---

## åº”ç”¨åœºæ™¯

PSI æŠ€æœ¯åœ¨å¤šä¸ªé¢†åŸŸéƒ½æœ‰å¹¿æ³›åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å…¸å‹åœºæ™¯ï¼š

### åŒ»ç–—å¥åº·

**åœºæ™¯1ï¼šè·¨åŒ»é™¢è”åˆè¯Šç–—**
- **å‚ä¸æ–¹**ï¼šå¤šå®¶åŒ»é™¢
- **ç—›ç‚¹**ï¼šå„åŒ»é™¢æœ‰ç‹¬ç«‹çš„æ‚£è€…æ•°æ®ï¼Œæ— æ³•ç›´æ¥å…±äº«
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ PSI æ‰¾å‡ºå…±åŒæ‚£è€…ï¼Œåœ¨ä¸æ³„éœ²å…¶ä»–æ‚£è€…ä¿¡æ¯çš„å‰æä¸‹è¿›è¡Œè”åˆè¯Šç–—
- **ä»·å€¼**ï¼šæä¾›æ›´å…¨é¢çš„è¯Šç–—æ–¹æ¡ˆï¼Œæå‡åŒ»ç–—è´¨é‡

**åœºæ™¯2ï¼šæµè¡Œç—…å­¦ç ”ç©¶**
- **å‚ä¸æ–¹**ï¼šåŒ»é™¢ + ç–¾æ§ä¸­å¿ƒ
- **ç—›ç‚¹**ï¼šç–¾ç—…ä¼ æ’­åˆ†æéœ€è¦è·¨æœºæ„æ•°æ®ï¼Œä½†å—éšç§æ³•è§„é™åˆ¶
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI è¯†åˆ«æ„ŸæŸ“è€…äº¤é›†ï¼Œè¿½è¸ªä¼ æ’­é“¾
- **ä»·å€¼**ï¼šåŠæ—¶é¢„è­¦å’Œé˜²æ§ï¼Œä¿æŠ¤å…¬å…±å«ç”Ÿ

**åœºæ™¯3ï¼šè¯ç‰©ä¸´åºŠè¯•éªŒ**
- **å‚ä¸æ–¹**ï¼šåˆ¶è¯å…¬å¸ + åŒ»é™¢
- **ç—›ç‚¹**ï¼šéœ€è¦ç­›é€‰ç¬¦åˆæ¡ä»¶çš„å—è¯•è€…ï¼Œä½†ä¸èƒ½æ³„éœ²æ‚£è€…ä¿¡æ¯
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI åŒ¹é…ç¬¦åˆè¯•éªŒæ¡ä»¶çš„æ‚£è€…
- **ä»·å€¼**ï¼šåŠ é€Ÿæ–°è¯ç ”å‘ï¼Œé™ä½æ‹›å‹Ÿæˆæœ¬

---

### é‡‘èé¢†åŸŸ

**åœºæ™¯1ï¼šå¤šé“¶è¡Œåæ¬ºè¯ˆ**
- **å‚ä¸æ–¹**ï¼šå¤šå®¶é“¶è¡Œ
- **ç—›ç‚¹**ï¼šæ¬ºè¯ˆåˆ†å­åœ¨å¤šä¸ªé“¶è¡Œè¡Œéª—ï¼Œä½†é“¶è¡Œé—´ä¸èƒ½ç›´æ¥å…±äº«å®¢æˆ·åå•
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI è¯†åˆ«å…±åŒçš„é«˜é£é™©ç”¨æˆ·ï¼Œè”åˆé˜²èŒƒ
- **ä»·å€¼**ï¼šé™ä½æ¬ºè¯ˆæŸå¤±ï¼Œä¿æŠ¤å®¢æˆ·èµ„äº§

**åœºæ™¯2ï¼šè”åˆä¿¡ç”¨è¯„ä¼°**
- **å‚ä¸æ–¹**ï¼šé“¶è¡Œ + å¾ä¿¡æœºæ„
- **ç—›ç‚¹**ï¼šä¿¡ç”¨è¯„ä¼°éœ€è¦å¤šç»´åº¦æ•°æ®ï¼Œä½†æ•°æ®åˆ†æ•£åœ¨ä¸åŒæœºæ„
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI å¯¹é½ç”¨æˆ·æ•°æ®ï¼Œè”åˆå»ºæ¨¡
- **ä»·å€¼**ï¼šæé«˜ä¿¡ç”¨è¯„ä¼°å‡†ç¡®æ€§ï¼Œé™ä½åè´¦ç‡

**åœºæ™¯3ï¼šåæ´—é’±ç›‘æµ‹**
- **å‚ä¸æ–¹**ï¼šå¤šä¸ªé‡‘èæœºæ„
- **ç—›ç‚¹**ï¼šæ´—é’±è¡Œä¸ºæ¶‰åŠå¤šä¸ªé‡‘èæœºæ„ï¼Œéœ€è¦è”åˆç›‘æµ‹
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI è¯†åˆ«å¯ç–‘è´¦æˆ·äº¤é›†
- **ä»·å€¼**ï¼šæ»¡è¶³ç›‘ç®¡è¦æ±‚ï¼Œæ‰“å‡»é‡‘èçŠ¯ç½ª

---

### æ”¿åŠ¡ä¸å…¬å…±æœåŠ¡

**åœºæ™¯1ï¼šè·¨éƒ¨é—¨æ•°æ®ååŒ**
- **å‚ä¸æ–¹**ï¼šå…¬å®‰ã€æ°‘æ”¿ã€ç¨åŠ¡ç­‰æ”¿åºœéƒ¨é—¨
- **ç—›ç‚¹**ï¼šæ•°æ®å­¤å²›ä¸¥é‡ï¼Œè·¨éƒ¨é—¨åä½œå›°éš¾
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI å®ç°æ•°æ®å¯¹é½ï¼Œä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯
- **ä»·å€¼**ï¼šæå‡æ”¿åºœæ²»ç†æ•ˆç‡ï¼Œä¼˜åŒ–å…¬å…±æœåŠ¡

**åœºæ™¯2ï¼šç²¾å‡†æ‰¶è´«**
- **å‚ä¸æ–¹**ï¼šæ°‘æ”¿ã€æ‰¶è´«åŠã€åŒ»ä¿ç­‰éƒ¨é—¨
- **ç—›ç‚¹**ï¼šéœ€è¦è¯†åˆ«çœŸæ­£çš„å›°éš¾ç¾¤ä¼—ï¼Œä½†æ•°æ®åˆ†æ•£
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI å¤šéƒ¨é—¨æ•°æ®æ¯”å¯¹ï¼Œç²¾å‡†è¯†åˆ«
- **ä»·å€¼**ï¼šç¡®ä¿æ‰¶è´«èµ„æºç”¨åœ¨åˆ€åˆƒä¸Š

---

### äº’è”ç½‘ä¸å¹¿å‘Š

**åœºæ™¯1ï¼šè·¨å¹³å°ç²¾å‡†æŠ•æ”¾**
- **å‚ä¸æ–¹**ï¼šå¤šä¸ªå¹¿å‘Šå¹³å°
- **ç—›ç‚¹**ï¼šå¹¿å‘Šä¸»å¸Œæœ›è§¦è¾¾ç‰¹å®šç”¨æˆ·ï¼Œä½†ç”¨æˆ·æ•°æ®åˆ†æ•£åœ¨ä¸åŒå¹³å°
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI æ‰¾å‡ºå…±åŒç”¨æˆ·ï¼Œè”åˆæŠ•æ”¾
- **ä»·å€¼**ï¼šæé«˜å¹¿å‘Šè½¬åŒ–ç‡ï¼Œé™ä½æŠ•æ”¾æˆæœ¬

**åœºæ™¯2ï¼šç”µå•†è”åˆè¥é”€**
- **å‚ä¸æ–¹**ï¼šå¤šä¸ªç”µå•†å¹³å°æˆ–å•†å®¶
- **ç—›ç‚¹**ï¼šå¸Œæœ›è¯†åˆ«é«˜ä»·å€¼å®¢æˆ·ï¼Œä½†ä¸èƒ½å…±äº«ç”¨æˆ·æ•°æ®
- **è§£å†³æ–¹æ¡ˆ**ï¼šPSI è¯†åˆ«å…±åŒçš„é«˜ä»·å€¼å®¢æˆ·
- **ä»·å€¼**ï¼šç²¾å‡†è¥é”€ï¼Œæå‡ ROI

---

### åœºæ™¯å¯¹æ¯”

| é¢†åŸŸ | å…¸å‹å‚ä¸æ–¹ | æ•°æ®æ•æ„Ÿåº¦ | PSIä»·å€¼ | æŠ€æœ¯è¦æ±‚ |
|------|-----------|-----------|--------|---------|
| **åŒ»ç–—** | åŒ»é™¢ã€è¯ä¼ã€ç–¾æ§ | æé«˜ | åˆè§„çš„æ•°æ®åä½œ | é«˜å®‰å…¨æ€§ |
| **é‡‘è** | é“¶è¡Œã€å¾ä¿¡ã€æ”¯ä»˜ | æé«˜ | é£æ§ä¸åˆè§„ | é«˜æ€§èƒ½ |
| **æ”¿åŠ¡** | æ”¿åºœéƒ¨é—¨ | é«˜ | æ‰“ç ´æ•°æ®å­¤å²› | é«˜å¯ä¿¡åº¦ |
| **äº’è”ç½‘** | å¹³å°ã€å¹¿å‘Šå•† | ä¸­ | ç²¾å‡†è¥é”€ | é«˜æ•ˆç‡ |

---

## æŠ€æœ¯ä¼˜åŠ¿

### ä¸ä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éšç§ä¿æŠ¤ | è®¡ç®—æ•ˆç‡ | å®‰å…¨æ€§ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|--------|---------|
| **PSI (éšç§æ±‚äº¤)** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | IDå¯¹é½ã€é»‘åå•æ¯”å¯¹ |
| **æ˜æ–‡ä¼ è¾“** | âŒ | â­â­â­â­â­ | âŒ | å®Œå…¨æ³„éœ²éšç§ |
| **ä¸­å¿ƒåŒ–å¹³å°** | â­â­ | â­â­â­â­ | â­â­â­ | éœ€è¦ä¿¡ä»»ç¬¬ä¸‰æ–¹ |
| **åŒæ€åŠ å¯†** | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ | è®¡ç®—å¼€é”€å¤§ |

### æ ¸å¿ƒä¼˜åŠ¿

1. **å¼ºéšç§ä¿æŠ¤**
   - åŸºäºæ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰ï¼Œéœ€è¦ 10Â²Â² å¹´æ‰èƒ½æš´åŠ›ç ´è§£
   - åŠ ç›å’ŒéšæœºåŒ–ï¼Œé˜²æ­¢å½©è™¹è¡¨æ”»å‡»
   - ä¸ç»æ„ä¼ è¾“ï¼ˆOTï¼‰åè®®ï¼Œä¿æŠ¤æŸ¥è¯¢éšç§

2. **é«˜æ€§èƒ½**
   - 256ä½ECC = 3072ä½RSAå®‰å…¨æ€§
   - åŠ è§£å¯†é€Ÿåº¦æ¯”RSAå¿«10å€ä»¥ä¸Š
   - æ”¯æŒç™¾ä¸‡çº§æ•°æ®é›†è®¡ç®—

3. **åˆè§„æ€§**
   - ç¬¦åˆã€Šæ•°æ®å®‰å…¨æ³•ã€‹è¦æ±‚
   - æ»¡è¶³ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹è§„èŒƒ
   - é€šè¿‡ç­‰ä¿ä¸‰çº§è®¤è¯

4. **æ˜“é›†æˆ**
   - æä¾›å¤šè¯­è¨€SDKï¼ˆPythonã€Javaã€C++ï¼‰
   - å¼€ç®±å³ç”¨çš„API
   - å®Œå–„çš„æ–‡æ¡£å’Œç¤ºä¾‹

---

## äº†è§£æ›´å¤š

### å…³é”®æŠ€æœ¯è¯¦è§£

::: details æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆECCï¼‰è¯¦è§£

### ä»€ä¹ˆæ˜¯æ¤­åœ†æ›²çº¿ï¼Ÿ

**æ•°å­¦å®šä¹‰**ï¼š
```
yÂ² = xÂ³ + ax + b
```

**å¯è§†åŒ–**ï¼ˆåƒä¸€ä¸ªå¯¹ç§°çš„æ›²çº¿ï¼‰ï¼š
```
      y
      â†‘
      |     â•±â•²
      |    â•±  â•²
  â€”â€”â€”â€”|â€”â€”â€”â•±â”€â”€â”€â”€â•²â€”â€”â€”â€”â†’ x
      |  â•±      â•²
      | â•±        â•²
```

### ä¸ºä»€ä¹ˆç”¨æ¤­åœ†æ›²çº¿ï¼Ÿ

#### ä¼ ç»ŸåŠ å¯† RSA vs æ¤­åœ†æ›²çº¿ ECC

| å¯¹æ¯” | RSA | ECC |
|------|-----|-----|
| **å¯†é’¥é•¿åº¦** | 2048 ä½ | 256 ä½ |
| **å®‰å…¨å¼ºåº¦** | ç›¸åŒ | ç›¸åŒ |
| **è®¡ç®—é€Ÿåº¦** | æ…¢ | å¿« |
| **é€‚åˆç§»åŠ¨è®¾å¤‡** | âŒ | âœ… |

**ç±»æ¯”**ï¼š
- **RSA**ï¼šåƒä¸€æŠŠå·¨å¤§çš„é’¥åŒ™ï¼ˆ2048ä½ï¼‰
- **ECC**ï¼šåƒä¸€æŠŠå°å·§çš„é’¥åŒ™ï¼ˆ256ä½ï¼‰ï¼Œä½†åŒæ ·å®‰å…¨

---

### æ¤­åœ†æ›²çº¿åœ¨ PSI ä¸­çš„åº”ç”¨

#### ECDH-PSI åè®®ï¼ˆSecretFlow ä½¿ç”¨çš„ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šåˆ©ç”¨æ¤­åœ†æ›²çº¿çš„ç‰¹æ®Šæ€§è´¨

```
æ•°å­¦æ€§è´¨ï¼ˆäº¤æ¢å¾‹ï¼‰ï¼š
a Ã— (b Ã— G) = b Ã— (a Ã— G)
    â†“
åŒæ–¹ç”¨ä¸åŒå¯†é’¥åŠ å¯†ï¼Œç»“æœç›¸åŒï¼
```

**å…·ä½“è¿‡ç¨‹**ï¼š

```
å‚ä¸æ–¹ A çš„æ•°æ®ï¼š[1001, 1002, 1003]
å‚ä¸æ–¹ B çš„æ•°æ®ï¼š[1002, 1004, 1005]

æ­¥éª¤1ï¼šå‚ä¸æ–¹ A ç”Ÿæˆç§é’¥ a
æ­¥éª¤2ï¼šå‚ä¸æ–¹ B ç”Ÿæˆç§é’¥ b

æ­¥éª¤3ï¼šå‚ä¸æ–¹ A åŠ å¯†è‡ªå·±çš„æ•°æ®
    åŠ å¯†(1001) = a Ã— Hash(1001)  â†’ Aâ‚
    åŠ å¯†(1002) = a Ã— Hash(1002)  â†’ Aâ‚‚
    åŠ å¯†(1003) = a Ã— Hash(1003)  â†’ Aâ‚ƒ
    
æ­¥éª¤4ï¼šå‚ä¸æ–¹ A å‘é€ [Aâ‚, Aâ‚‚, Aâ‚ƒ] ç»™å‚ä¸æ–¹ B

æ­¥éª¤5ï¼šå‚ä¸æ–¹ B å†æ¬¡åŠ å¯†ï¼ˆç”¨è‡ªå·±çš„å¯†é’¥ bï¼‰
    b Ã— Aâ‚ = b Ã— (a Ã— Hash(1001))
    b Ã— Aâ‚‚ = b Ã— (a Ã— Hash(1002))
    b Ã— Aâ‚ƒ = b Ã— (a Ã— Hash(1003))
    
æ­¥éª¤6ï¼šå‚ä¸æ–¹ B ä¹ŸåŠ å¯†è‡ªå·±çš„æ•°æ®
    åŠ å¯†(1002) = a Ã— Hash(1002)  â†’ Bâ‚
    åŠ å¯†(1004) = a Ã— Hash(1004)  â†’ Bâ‚‚
    åŠ å¯†(1005) = a Ã— Hash(1005)  â†’ Bâ‚ƒ

æ­¥éª¤7ï¼šå‚ä¸æ–¹ B å‘é€ç»™å‚ä¸æ–¹ Aï¼ŒA å†åŠ å¯†
    a Ã— Bâ‚ = a Ã— (b Ã— Hash(1002))
    
æ­¥éª¤8ï¼šæ¯”è¾ƒåŒé‡åŠ å¯†çš„ç»“æœ
    a Ã— (b Ã— Hash(1002)) = b Ã— (a Ã— Hash(1002))
    â†‘ å‚ä¸æ–¹ B çš„      â†‘ å‚ä¸æ–¹ A çš„
    
    ä¸¤ä¸ªç»“æœç›¸åŒï¼â†’ æ‰¾åˆ°äº¤é›†ï¼š1002
```

**å…³é”®ç‚¹**ï¼š
- âœ… åŒæ–¹éƒ½ä¸çŸ¥é“å¯¹æ–¹çš„åŸå§‹æ•°æ®
- âœ… åŒæ–¹éƒ½ä¸çŸ¥é“å¯¹æ–¹çš„ç§é’¥
- âœ… åªæœ‰äº¤é›†çš„åŒé‡åŠ å¯†ç»“æœç›¸åŒ
- âœ… æ— æ³•æš´åŠ›ç ´è§£ï¼ˆæ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°éš¾é¢˜ï¼‰

---

### ä¸ºä»€ä¹ˆæ— æ³•æš´åŠ›ç ´è§£ï¼Ÿ

**æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜**ï¼š

```
å·²çŸ¥ï¼šGï¼ˆåŸºç‚¹ï¼‰ã€a Ã— Gï¼ˆå…¬é’¥ï¼‰
æ±‚ï¼šaï¼ˆç§é’¥ï¼‰
```

**éš¾åº¦**ï¼š
- RSA 2048ä½ â‰ˆ éœ€è¦ 2Â¹Â¹Â² æ¬¡è¿ç®—
- ECC 256ä½ â‰ˆ éœ€è¦ 2Â¹Â²â¸ æ¬¡è¿ç®—

**æ—¶é—´ä¼°ç®—**ï¼š
```
å‡è®¾ä½ æœ‰å…¨ä¸–ç•Œæœ€å¿«çš„è¶…çº§è®¡ç®—æœºï¼š
- é€Ÿåº¦ï¼š1 Exaflop = 10Â¹â¸ æ¬¡è¿ç®—/ç§’
- ç ´è§£ ECC-256ï¼šéœ€è¦ 10Â²Â² å¹´
- å®‡å®™å¹´é¾„ï¼šåªæœ‰ 138 äº¿å¹´ï¼ˆ10Â¹â° å¹´ï¼‰

ç»“è®ºï¼šæ¯”å®‡å®™å¯¿å‘½è¿˜é•¿ 1 ä¸‡äº¿å€ï¼
```

:::

::: details OT åè®®ï¼ˆOblivious Transferï¼‰è¯¦è§£

### ä»€ä¹ˆæ˜¯ OTï¼Ÿ

**è‹±æ–‡**ï¼šOblivious Transfer  
**æ ¸å¿ƒ**ï¼šé€‰æ‹©æ€§æ¥æ”¶ä¿¡æ¯ï¼Œå‘é€æ–¹ä¸çŸ¥é“ä½ é€‰äº†ä»€ä¹ˆ

### ç”Ÿæ´»ç±»æ¯”

**åœºæ™¯**ï¼šå›¾ä¹¦é¦†å€Ÿä¹¦

**æ™®é€šæ–¹å¼**ï¼ˆä¸å®‰å…¨ï¼‰ï¼š
```
ä½ ï¼šæˆ‘è¦å€Ÿã€Šå¯†ç å­¦ã€‹
å›¾ä¹¦ç®¡ç†å‘˜ï¼šå¥½çš„ï¼ˆçŸ¥é“ä½ å€Ÿäº†ä»€ä¹ˆï¼‰
```

**OT æ–¹å¼**ï¼ˆå®‰å…¨ï¼‰ï¼š
```
ä½ ï¼šæˆ‘è¦å€Ÿ [ç§˜å¯†é€‰æ‹©ï¼šç¬¬3æœ¬]
å›¾ä¹¦ç®¡ç†å‘˜ï¼šè¿™æ˜¯æ‰€æœ‰ä¹¦çš„åŠ å¯†ç‰ˆæœ¬
ä½ ï¼š[åªè§£å¯†ç¬¬3æœ¬]

ç»“æœï¼š
- âœ… ä½ æ‹¿åˆ°äº†ã€Šå¯†ç å­¦ã€‹
- âœ… å›¾ä¹¦ç®¡ç†å‘˜ä¸çŸ¥é“ä½ å€Ÿäº†å“ªæœ¬
```

---

### OT åœ¨ PSI ä¸­çš„åº”ç”¨

#### 1-out-of-2 OTï¼ˆæœ€åŸºç¡€çš„ï¼‰

**åœºæ™¯**ï¼šå‚ä¸æ–¹ A æƒ³çŸ¥é“æ‚£è€… 1002 æ˜¯å¦åœ¨å‚ä¸æ–¹ B

```
å‚ä¸æ–¹ B æœ‰æ•°æ®ï¼š[1002, 1004, 1005]

å‚ä¸æ–¹ A æƒ³æŸ¥è¯¢ï¼š1002 åœ¨ä¸åœ¨ï¼Ÿ

ä¼ ç»Ÿæ–¹å¼ï¼š
å‚ä¸æ–¹ Aï¼šä½ æœ‰ 1002 å—ï¼Ÿ
å‚ä¸æ–¹ Bï¼šæœ‰
    â†“
é—®é¢˜ï¼šå‚ä¸æ–¹ B çŸ¥é“å‚ä¸æ–¹ A åœ¨æŸ¥è°

OT æ–¹å¼ï¼š
æ­¥éª¤1ï¼šå‚ä¸æ–¹ B å‡†å¤‡ä¸¤ä¸ªæ¶ˆæ¯
    mâ‚€ = "ä¸åœ¨"ï¼ˆåŠ å¯†ï¼‰
    mâ‚ = "åœ¨"ï¼ˆåŠ å¯†ï¼‰

æ­¥éª¤2ï¼šå‚ä¸æ–¹ A ç§˜å¯†é€‰æ‹©ï¼ˆåŸºäº 1002 æ˜¯å¦åœ¨è‡ªå·±æ•°æ®é‡Œï¼‰
    é€‰æ‹© b âˆˆ {0, 1}

æ­¥éª¤3ï¼šå‚ä¸æ–¹ A åªèƒ½è§£å¯†ä¸€ä¸ªæ¶ˆæ¯
    å¦‚æœ 1002 åœ¨ï¼šè§£å¯† mâ‚ â†’ "åœ¨"
    å¦‚æœä¸åœ¨ï¼šè§£å¯† mâ‚€ â†’ "ä¸åœ¨"

ç»“æœï¼š
- âœ… å‚ä¸æ–¹ A çŸ¥é“äº†ç»“æœ
- âœ… å‚ä¸æ–¹ B ä¸çŸ¥é“å‚ä¸æ–¹ A æŸ¥äº†ä»€ä¹ˆ
```

---

#### KKRT-PSIï¼ˆSecretFlow å¦ä¸€ç§åè®®ï¼‰

**ä½¿ç”¨å¤§é‡ OT æ¥å®ç°å¤§è§„æ¨¡ PSI**

```
å‚ä¸æ–¹ A æœ‰ 10,000 ä¸ªæ‚£è€…
å‚ä¸æ–¹ B æœ‰ 10,000 ä¸ªæ‚£è€…

ä½¿ç”¨ KKRTï¼š
1. ç”¨ OT æ‰©å±•æŠ€æœ¯ï¼ˆå‡å°‘è®¡ç®—é‡ï¼‰
2. æ‰¹é‡å¤„ç†ï¼ˆå¹¶è¡Œè®¡ç®—ï¼‰
3. åªä¼ è¾“æœ€å°å¿…è¦ä¿¡æ¯

æ€§èƒ½ï¼š
- æ™®é€š OTï¼š10,000 Ã— 10,000 = 1äº¿æ¬¡ OT
- KKRTï¼šåªéœ€è¦çº¦ 10,000 æ¬¡ OT
```

---

### OT çš„æ•°å­¦åŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰

**åŸºäº RSA çš„ OT**ï¼š

```
å‘é€æ–¹æœ‰ä¸¤ä¸ªæ¶ˆæ¯ï¼šmâ‚€ å’Œ mâ‚
æ¥æ”¶æ–¹æƒ³è¦ máµ¦ï¼ˆb æ˜¯ 0 æˆ– 1ï¼‰

æ­¥éª¤1ï¼šå‘é€æ–¹ç”Ÿæˆ RSA å¯†é’¥å¯¹
    å…¬é’¥ï¼š(N, e)
    ç§é’¥ï¼šd

æ­¥éª¤2ï¼šå‘é€æ–¹ç”Ÿæˆä¸¤ä¸ªéšæœºæ•°
    xâ‚€, xâ‚

æ­¥éª¤3ï¼šæ¥æ”¶æ–¹é€‰æ‹© bï¼Œç”Ÿæˆéšæœºæ•° k
    å¦‚æœ b=0ï¼šv = (xâ‚€ + k^e) mod N
    å¦‚æœ b=1ï¼šv = (xâ‚ + k^e) mod N
    
æ­¥éª¤4ï¼šå‘é€æ–¹è®¡ç®—
    kâ‚€ = (v - xâ‚€)^d mod N
    kâ‚ = (v - xâ‚)^d mod N
    
    å¦‚æœæ¥æ”¶æ–¹é€‰äº† b=0ï¼škâ‚€ = kï¼ˆæ­£ç¡®ï¼‰
    å¦‚æœæ¥æ”¶æ–¹é€‰äº† b=1ï¼škâ‚ = kï¼ˆæ­£ç¡®ï¼‰

æ­¥éª¤5ï¼šå‘é€æ–¹åŠ å¯†æ¶ˆæ¯
    å‘é€ mâ‚€ + kâ‚€ å’Œ mâ‚ + kâ‚

æ­¥éª¤6ï¼šæ¥æ”¶æ–¹åªèƒ½è§£å¯†æ­£ç¡®çš„
    å¦‚æœ b=0ï¼š(mâ‚€ + kâ‚€) - k = mâ‚€ âœ…
    å¦‚æœ b=1ï¼š(mâ‚ + kâ‚) - k = mâ‚ âœ…
```

:::

::: details åŠ ç›ï¼ˆSaltï¼‰å’ŒéšæœºåŒ–è¯¦è§£

### ä»€ä¹ˆæ˜¯åŠ ç›ï¼Ÿ

**ç®€åŒ–ç‰ˆï¼ˆä¸å®‰å…¨ï¼‰**ï¼š
```python
hash = SHA256("1001")
# é—®é¢˜ï¼šæ¯æ¬¡ç»“æœéƒ½ä¸€æ ·
# "1001" æ°¸è¿œæ˜¯ "8d969eef..."
```

**åŠ ç›ç‰ˆï¼ˆå®‰å…¨ï¼‰**ï¼š
```python
salt = random_bytes(32)  # éšæœºç”Ÿæˆ
hash = SHA256("1001" + salt)
# æ¯æ¬¡ç»“æœéƒ½ä¸åŒ
# ç¬¬1æ¬¡ï¼š"a3f7c2e9..."
# ç¬¬2æ¬¡ï¼š"b9d4e1f6..."
```

---

### ä¸ºä»€ä¹ˆéœ€è¦åŠ ç›ï¼Ÿ

#### é˜²æ­¢å½©è™¹è¡¨æ”»å‡»

**å½©è™¹è¡¨**ï¼šé¢„å…ˆè®¡ç®—çš„å“ˆå¸Œè¡¨

```
æ²¡æœ‰åŠ ç›çš„æƒ…å†µï¼š
æ”»å‡»è€…é¢„å…ˆè®¡ç®—ï¼š
1000 â†’ "8a7f3c2e..."
1001 â†’ "8d969eef..."
1002 â†’ "ad57366e..."
...
9999 â†’ "f4e9d7c5..."

ç„¶åç›´æ¥æŸ¥è¡¨ç ´è§£ âŒ
```

**åŠ ç›å**ï¼š
```
æ¯æ¬¡ç›éƒ½ä¸åŒï¼Œæ”»å‡»è€…æ— æ³•é¢„å…ˆè®¡ç®—
1001 + salt1 â†’ "a3f7c2e9..."
1001 + salt2 â†’ "b9d4e1f6..."

å½©è™¹è¡¨å¤±æ•ˆ âœ…
```

---

### åœ¨ PSI ä¸­çš„åŠ ç›

**åŒé‡åŠ ç›**ï¼š

```python
# SecretFlow PSI çš„å®é™…åšæ³•

# æ­¥éª¤1ï¼šå‚ä¸æ–¹ A ç”Ÿæˆéšæœºç›
salt_a = random_bytes(32)

# æ­¥éª¤2ï¼šåŠ ç›å“ˆå¸Œ
data = 1001
hashed = SHA256(str(data) + salt_a)

# æ­¥éª¤3ï¼šæ¤­åœ†æ›²çº¿åŠ å¯†
encrypted = privatekey_a Ã— Hash_to_Point(hashed)

# æ­¥éª¤4ï¼šå‚ä¸æ–¹ B å†åŠ ç›å†åŠ å¯†
salt_b = random_bytes(32)
hashed2 = SHA256(encrypted + salt_b)
encrypted2 = privatekey_b Ã— Hash_to_Point(hashed2)
```

**å¤šå±‚ä¿æŠ¤**ï¼š
1. âœ… ç›ä¿æŠ¤åŸå§‹æ•°æ®
2. âœ… æ¤­åœ†æ›²çº¿åŠ å¯†ä¿æŠ¤å“ˆå¸Œ
3. âœ… åŒæ–¹éƒ½ä¸çŸ¥é“å¯¹æ–¹çš„ç›å’Œç§é’¥

---

### éšæœºåŒ–ï¼ˆRandomizationï¼‰

**ç›®çš„**ï¼šéšè—æ•°æ®é›†å¤§å°å’Œåˆ†å¸ƒ

```python
# çœŸå®æ•°æ®é›†
real_data = [1001, 1002, 1003]  # 3ä¸ª

# æ·»åŠ è™šå‡æ•°æ®ï¼ˆpaddingï¼‰
noise_data = [random_id() for _ in range(random(0, 10))]
padded_data = real_data + noise_data
# [1001, 1002, 1003, 8374, 2918, 5647, ...]  # 3-13ä¸ª

# éšæœºæ’åº
shuffled = shuffle(padded_data)
```

**å¥½å¤„**ï¼š
- âœ… æ”»å‡»è€…ä¸çŸ¥é“çœŸå®æ•°æ®é›†æœ‰å¤šå¤§
- âœ… æ— æ³•é€šè¿‡ç»Ÿè®¡åˆ†ææ¨æ–­

:::

::: details å®Œæ•´çš„ PSI æµç¨‹ï¼ˆæ‰€æœ‰æŠ€æœ¯ç»“åˆï¼‰

### çœŸæ­£çš„ SecretFlow ECDH-PSI

```
å‚ä¸æ–¹ A                                å‚ä¸æ–¹ B
  |                                      |
  | 1. ç”Ÿæˆç§é’¥ a                        | 1. ç”Ÿæˆç§é’¥ b
  |    salt_a                            |    salt_b
  |                                      |
  | 2. åŠ ç›å“ˆå¸Œ                          | 2. åŠ ç›å“ˆå¸Œ
  |    h_a = SHA256(data + salt_a)      |    h_b = SHA256(data + salt_b)
  |                                      |
  | 3. æ¤­åœ†æ›²çº¿åŠ å¯†                      | 3. æ¤­åœ†æ›²çº¿åŠ å¯†
  |    E_a = a Ã— Hash_to_Point(h_a)     |    E_b = b Ã— Hash_to_Point(h_b)
  |                                      |
  | 4. æ·»åŠ éšæœºå™ªå£°                      | 4. æ·»åŠ éšæœºå™ªå£°
  |    E_a' = E_a + random_points       |    E_b' = E_b + random_points
  |                                      |
  | 5. å‘é€ E_a' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ |
  |                                      | 6. ç”¨ b å†åŠ å¯†
  |                                      |    E_ab = b Ã— E_a'
  | â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å‘é€ E_ab   |
  |                                      |
  | 7. å‘é€ E_b' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’|
  |                                      | 8. ç”¨ a å†åŠ å¯†  
  | 9. ç”¨ a å†åŠ å¯†                       |    E_ba = a Ã— E_b'
  |    E_ab = a Ã— E_b'                   |
  |                                      |
  | 10. æ¯”è¾ƒ E_ab å’Œ E_ba               | 10. æ¯”è¾ƒ E_ab å’Œ E_ba
  |     ç›¸åŒ â†’ äº¤é›†                      |     ç›¸åŒ â†’ äº¤é›†
  |                                      |
  | 11. ä½¿ç”¨ OT åè®®ç¡®è®¤                 | 11. OT éªŒè¯
  |     ï¼ˆåŒæ–¹ä¸çŸ¥é“å¯¹æ–¹æŸ¥äº†ä»€ä¹ˆï¼‰       |
  |                                      |
  | 12. è¾“å‡ºäº¤é›†                         | 12. è¾“å‡ºäº¤é›†
  |     [1002, 1003]                     |     [1002, 1003]
```

### å®‰å…¨æ€§å¯¹æ¯”

**ç®€åŒ–ç‰ˆ vs çœŸæ­£çš„ SecretFlow**

| æ”»å‡»æ–¹å¼ | ç®€åŒ–ç‰ˆ | SecretFlow PSI |
|---------|--------|----------------|
| **æš´åŠ›ç ´è§£** | âŒ å¯ä»¥ | âœ… ä¸å¯ä»¥ï¼ˆæ¤­åœ†æ›²çº¿ï¼‰ |
| **å½©è™¹è¡¨** | âŒ å¯ä»¥ | âœ… ä¸å¯ä»¥ï¼ˆåŠ ç›ï¼‰ |
| **æ¨æ–­æ•°æ®é‡** | âŒ å¯ä»¥ | âœ… ä¸å¯ä»¥ï¼ˆéšæœºåŒ–ï¼‰ |
| **ç›‘å¬ç½‘ç»œ** | âŒ å¯ä»¥æ¨æ–­ | âœ… åªçœ‹åˆ°åŠ å¯†æ•°æ® |
| **æ¨æ–­æŸ¥è¯¢å†…å®¹** | âŒ å¯ä»¥ | âœ… ä¸å¯ä»¥ï¼ˆOTï¼‰ |

### æŠ€æœ¯ç»„åˆçš„å¨åŠ›

**æ¯ä¸ªæŠ€æœ¯é˜²å¾¡ä¸€ç±»æ”»å‡»**ï¼š

```
æ¤­åœ†æ›²çº¿åŠ å¯†
    â†“ é˜²æ­¢ï¼šæš´åŠ›ç ´è§£åŸå§‹æ•°æ®
    
åŠ ç›
    â†“ é˜²æ­¢ï¼šå½©è™¹è¡¨æ”»å‡»
    
éšæœºåŒ–
    â†“ é˜²æ­¢ï¼šç»Ÿè®¡åˆ†ææ”»å‡»
    
OT åè®®
    â†“ é˜²æ­¢ï¼šæ¨æ–­æŸ¥è¯¢å†…å®¹
    
å¤šå±‚ç»„åˆ
    â†“ ç»“æœï¼šæ— æ³•æ”»ç ´ âœ…
```

### æ€§èƒ½å¯¹æ¯”

**è®¡ç®—å¤æ‚åº¦**

| æ“ä½œ | ç®€åŒ–ç‰ˆ | SecretFlow PSI |
|------|--------|----------------|
| **åŠ å¯†** | O(n) | O(n log n) |
| **é€šä¿¡** | O(n) | O(n) |
| **å†…å­˜** | O(n) | O(n) |

**ç¤ºä¾‹**ï¼ˆ10,000 æ¡æ•°æ®ï¼‰ï¼š
- ç®€åŒ–ç‰ˆï¼š0.1 ç§’
- SecretFlowï¼š5-10 ç§’

**ä½† SecretFlow æ¢æ¥äº†**ï¼š
- âœ… å¯†ç å­¦çº§åˆ«çš„å®‰å…¨ä¿è¯
- âœ… å¯ä»¥ç”¨äºçœŸå®ç”Ÿäº§ç¯å¢ƒ

:::

::: details æ·±å…¥å­¦ä¹ èµ„æº

**æ¤­åœ†æ›²çº¿å¯†ç å­¦**ï¼š
- ğŸ“– ä¹¦ç±ï¼šã€Šæ·±å…¥æµ…å‡ºå¯†ç å­¦ã€‹
- ğŸ“ è¯¾ç¨‹ï¼šCoursera - Cryptography I

**OT åè®®**ï¼š
- ğŸ“„ è®ºæ–‡ï¼šIshai et al. "Extending Oblivious Transfers Efficiently"
- ğŸ”— åšå®¢ï¼šhttps://bristolcrypto.blogspot.com/2016/10/what-is-oblivious-transfer.html

**SecretFlow å®ç°**ï¼š
- ğŸ“š å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.secretflow.org.cn
- ğŸ’» æºä»£ç ï¼šhttps://github.com/secretflow/secretflow

### ä¸‰å¤§æŠ€æœ¯çš„ä½œç”¨

| æŠ€æœ¯ | ä½œç”¨ | ç±»æ¯” |
|------|------|------|
| **æ¤­åœ†æ›²çº¿** | æ— æ³•ç ´è§£çš„åŠ å¯† | ä¿é™©ç®± |
| **OT åè®®** | éšè—æŸ¥è¯¢æ„å›¾ | åŒ¿åä¿¡ç®± |
| **åŠ ç›éšæœºåŒ–** | é˜²æ­¢ç»Ÿè®¡åˆ†æ | çƒŸé›¾å¼¹ |

:::

### ç›¸å…³èµ„æº

- [éšè¯­å®˜æ–¹æ–‡æ¡£](https://www.secretflow.org.cn/)
- [GitHub ä»“åº“](https://github.com/secretflow/secretflow)
- [PSI è®ºæ–‡åˆé›†](https://github.com/secretflow/awesome-psi)
- [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV1xx4y1Q7zF/)

---

> **æç¤º**ï¼šæƒ³è¦å®é™…åº”ç”¨ PSI æŠ€æœ¯ï¼Ÿå¯ä»¥ä¸‹è½½éšè¯­ SDKï¼Œå‡ è¡Œä»£ç å°±èƒ½å®ç°ï¼
