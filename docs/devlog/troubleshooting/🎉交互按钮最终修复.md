# ğŸ‰ äº¤äº’æŒ‰é’®æœ€ç»ˆä¿®å¤å®Œæˆ

---

## âŒ é—®é¢˜æ ¹æº

```
ReferenceError: runPSI is not defined
at HTMLButtonElement.onclick (tech/:1:1)
```

**åŸå› **ï¼šJavaScript å‡½æ•° `runPSI` æ²¡æœ‰è¢«æ­£ç¡®å®šä¹‰åˆ°å…¨å±€ä½œç”¨åŸŸã€‚

---

## ğŸ” é—®é¢˜è¯¦è§£

### VuePress çš„ä½œç”¨åŸŸé—®é¢˜

åœ¨ Markdown æ–‡ä»¶ä¸­ç›´æ¥å†™çš„ `<script>` æ ‡ç­¾ï¼Œé‡Œé¢å®šä¹‰çš„å‡½æ•°é»˜è®¤**ä¸åœ¨å…¨å±€ä½œç”¨åŸŸ**ä¸­ã€‚

#### åŸæ¥çš„ä»£ç ï¼ˆâŒ é”™è¯¯ï¼‰

```javascript
<script>
async function runPSI() {
  // ... å‡½æ•°å†…å®¹
}
</script>
```

**é—®é¢˜**ï¼š
- è¿™ä¸ªå‡½æ•°åªåœ¨å½“å‰æ¨¡å—ä½œç”¨åŸŸä¸­
- `onclick="runPSI()"` åœ¨å…¨å±€ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°

### HTML onclick çš„ä½œç”¨åŸŸ

```html
<button onclick="runPSI()">è®¡ç®—</button>
```

- `onclick` å±æ€§ä¸­çš„ä»£ç åœ¨**å…¨å±€ä½œç”¨åŸŸ**æ‰§è¡Œ
- éœ€è¦å‡½æ•°æŒ‚è½½åˆ° `window` å¯¹è±¡ä¸Š

---

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. å°†å‡½æ•°æŒ‚è½½åˆ° window å¯¹è±¡

```javascript
window.runPSI = async function() {
  // ... å‡½æ•°å†…å®¹
}
```

### 2. æ·»åŠ  SSR ä¿æŠ¤

```javascript
if (typeof window !== 'undefined') {
  // åªåœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ
  window.runPSI = async function() {
    // ... å‡½æ•°å†…å®¹
  }
}
```

**ä¸ºä»€ä¹ˆéœ€è¦**ï¼š
- VuePress æ„å»ºæ—¶ä¼šè¿›è¡Œ SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰
- Node.js ç¯å¢ƒæ²¡æœ‰ `window` å¯¹è±¡
- éœ€è¦è·³è¿‡ SSRï¼Œåªåœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œ

---

## ğŸ“ æœ€ç»ˆä»£ç 

### ä¿®æ”¹åçš„å®Œæ•´ä»£ç 

```javascript
<script>
if (typeof window !== 'undefined') {
  // SHA-256 å“ˆå¸Œå‡½æ•°
  async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  // è¿è¡Œ PSIï¼ˆæŒ‚è½½åˆ°å…¨å±€ï¼‰
  window.runPSI = async function() {
    const button = event.target;
    button.textContent = 'â³ è®¡ç®—ä¸­...';
    button.disabled = true;
    
    // è·å–è¾“å…¥
    const hospitalAInput = document.getElementById('hospital-a').value;
    const hospitalBInput = document.getElementById('hospital-b').value;
    const hospitalA = hospitalAInput.split(',').map(x => x.trim()).filter(x => x);
    const hospitalB = hospitalBInput.split(',').map(x => x.trim()).filter(x => x);
    
    // æ¨¡æ‹ŸåŠ å¯†è¿‡ç¨‹
    const hashedA = await Promise.all(hospitalA.map(id => sha256(id)));
    const hashedB = await Promise.all(hospitalB.map(id => sha256(id)));
    
    // è®¡ç®—äº¤é›†
    const intersection = [];
    const hashMap = new Map();
    for (let i = 0; i < hospitalA.length; i++) {
      hashMap.set(hashedA[i], hospitalA[i]);
    }
    for (let i = 0; i < hospitalB.length; i++) {
      if (hashMap.has(hashedB[i])) {
        intersection.push(hospitalB[i]);
      }
    }
    
    // æ˜¾ç¤ºç»“æœ
    document.getElementById('intersection-result').innerHTML = 
      `<strong>å…±åŒæ‚£è€… IDï¼š</strong><span>[${intersection.join(', ')}]</span>`;
    document.getElementById('count-result').innerHTML = 
      `<strong>å…±åŒæ‚£è€…æ•°é‡ï¼š</strong><span>${intersection.length}</span>`;
    
    // æ˜¾ç¤ºåŠ å¯†ç»†èŠ‚
    let hashDetails = '<div><strong>åŒ»é™¢ A çš„å“ˆå¸Œï¼š</strong></div>';
    hospitalA.slice(0, 3).forEach((id, i) => {
      hashDetails += `<div>${id} â†’ ${hashedA[i].substring(0, 16)}...</div>`;
    });
    hashDetails += '<div><strong>åŒ»é™¢ B çš„å“ˆå¸Œï¼š</strong></div>';
    hospitalB.slice(0, 3).forEach((id, i) => {
      hashDetails += `<div>${id} â†’ ${hashedB[i].substring(0, 16)}...</div>`;
    });
    document.getElementById('hash-content').innerHTML = hashDetails;
    document.getElementById('psi-result').style.display = 'block';
    
    // æ¢å¤æŒ‰é’®
    button.textContent = 'ğŸ”’ è®¡ç®—éšç§äº¤é›†';
    button.disabled = false;
  }

  // æŒ‰é’®æ‚¬åœæ•ˆæœ
  document.addEventListener('DOMContentLoaded', function() {
    const button = document.querySelector('#psi-demo button');
    if (button) {
      button.addEventListener('mouseover', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 5px 20px rgba(102, 126, 234, 0.4)';
      });
      button.addEventListener('mouseout', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = 'none';
      });
    }
  });
}
</script>
```

---

## ğŸ”‘ å…³é”®æ”¹åŠ¨

### 1. åŒ…è£¹æ•´ä¸ªä»£ç å—

```javascript
if (typeof window !== 'undefined') {
  // æ‰€æœ‰æµè§ˆå™¨ç«¯ä»£ç 
}
```

### 2. æŒ‚è½½åˆ° window

```javascript
window.runPSI = async function() { ... }
```

ä¸æ˜¯ï¼š
```javascript
async function runPSI() { ... }  // âŒ ä¸åœ¨å…¨å±€ä½œç”¨åŸŸ
```

### 3. sha256 å‡½æ•°å¯ä»¥ä¸æŒ‚è½½

```javascript
async function sha256(message) { ... }
```

**ä¸ºä»€ä¹ˆ**ï¼š
- `sha256` åªåœ¨ `runPSI` å†…éƒ¨è°ƒç”¨
- ä¸éœ€è¦å…¨å±€è®¿é—®
- ä¿æŒåœ¨é—­åŒ…å†…å³å¯

---

## ğŸŒ è®¿é—®æµ‹è¯•ï¼ˆç­‰å¾… 2-3 åˆ†é’Ÿï¼‰

```
https://paopaotai.github.io/secretflow-demo/tech/
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. ç­‰å¾… 2-3 åˆ†é’Ÿï¼ˆGitHub Pages æ›´æ–°ï¼‰

### 2. è®¿é—®ç½‘ç«™å¹¶å¼ºåˆ¶åˆ·æ–°
- Windows: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

### 3. æ‰¾åˆ°è“ç´«è‰²æ¼”ç¤ºåŒºåŸŸ

åº”è¯¥çœ‹åˆ°ï¼š
- ä¸¤ä¸ªè¾“å…¥æ¡†ï¼ˆåŒ»é™¢ A å’Œ Bï¼‰
- å¤§æŒ‰é’® "ğŸ”’ è®¡ç®—éšç§äº¤é›†"

### 4. æµ‹è¯•äº¤äº’

**æ“ä½œæµç¨‹**ï¼š
1. ä¿®æ”¹è¾“å…¥æ¡†çš„æ•°æ®ï¼ˆå¯é€‰ï¼‰
2. **ç‚¹å‡»æŒ‰é’®**
3. æŒ‰é’®æ–‡å­—åº”è¯¥å˜ä¸º "â³ è®¡ç®—ä¸­..."
4. 1 ç§’åæ˜¾ç¤ºç»“æœï¼š
   - å…±åŒæ‚£è€… IDï¼š[1002, 1003]
   - å…±åŒæ‚£è€…æ•°é‡ï¼š2
   - éšç§ä¿æŠ¤è¯´æ˜
   - åŠ å¯†è¿‡ç¨‹ï¼ˆå“ˆå¸Œå€¼ï¼‰

### 5. æ‰“å¼€æ§åˆ¶å°ç¡®è®¤æ— é”™è¯¯

æŒ‰ `F12` â†’ Console æ ‡ç­¾é¡µï¼š
- âœ… åº”è¯¥**æ²¡æœ‰çº¢è‰²é”™è¯¯**
- âœ… ç‚¹å‡»æŒ‰é’®ååº”è¯¥èƒ½çœ‹åˆ°ç»“æœ

---

## ğŸ“Š é—®é¢˜è§£å†³å†ç¨‹

| å°è¯• | æ–¹æ³• | ç»“æœ | åŸå›  |
|------|------|------|------|
| ç¬¬1æ¬¡ | å¤æ‚ HTML æ ¼å¼ | âŒ æ˜¾ç¤ºä»£ç æ–‡æœ¬ | Markdown è§£æé—®é¢˜ |
| ç¬¬2æ¬¡ | ä½¿ç”¨ `<ClientOnly>` | âŒ æ•´ä¸ªåŒºåŸŸç©ºç™½ | VuePress bug |
| ç¬¬3æ¬¡ | ç§»é™¤ `<ClientOnly>` | âœ… æ˜¾ç¤ºæ­£å¸¸ | âŒ æŒ‰é’®ç‚¹ä¸äº† |
| ç¬¬4æ¬¡ | `window.runPSI = ...` | âŒ SSR æŠ¥é”™ | ç¼ºå°‘ç¯å¢ƒæ£€æŸ¥ |
| ç¬¬5æ¬¡ | `if (typeof window)` + `window.runPSI` | âœ… **å®Œç¾è§£å†³** | âœ… |

---

## ğŸ’¡ æŠ€æœ¯æ€»ç»“

### åœ¨ VuePress ä¸­ä½¿ç”¨äº¤äº’å…ƒç´ çš„æœ€ä½³å®è·µ

#### 1. **å…¨å±€å‡½æ•°å¿…é¡»æŒ‚è½½åˆ° window**

```javascript
// âŒ é”™è¯¯
function myFunction() { }

// âœ… æ­£ç¡®
window.myFunction = function() { }
```

#### 2. **æ‰€æœ‰æµè§ˆå™¨ä»£ç éƒ½è¦æ£€æŸ¥ç¯å¢ƒ**

```javascript
// âœ… æ­£ç¡®
if (typeof window !== 'undefined') {
  // æµè§ˆå™¨ç«¯ä»£ç 
  window.myFunction = function() { }
  document.addEventListener(...)
}
```

#### 3. **onclick çš„æ›¿ä»£æ–¹æ¡ˆ**

å¦‚æœä¸æƒ³ç”¨ `onclick` å±æ€§ï¼Œå¯ä»¥ç”¨äº‹ä»¶ç›‘å¬ï¼š

```javascript
document.addEventListener('DOMContentLoaded', function() {
  const button = document.getElementById('my-button');
  button.addEventListener('click', async function() {
    // å¤„ç†ç‚¹å‡»
  });
});
```

ä½†è¿™æ ·æŒ‰é’®å°±éœ€è¦æœ‰ `id`ï¼š
```html
<button id="my-button">ç‚¹å‡»</button>
```

#### 4. **é¿å…ä½¿ç”¨ ClientOnly**

- VuePress 2.x çš„ `<ClientOnly>` æœ‰å·²çŸ¥é—®é¢˜
- ç‰¹åˆ«æ˜¯åŒ…å« `<script>` æ—¶ä¸ç¨³å®š
- ç›´æ¥ç”¨ `if (typeof window)` æ›´å¯é 

---

## ğŸš€ éƒ¨ç½²å®Œæˆ

- [x] ä»£ç å·²ä¿®å¤ï¼ˆæŒ‚è½½åˆ° windowï¼‰
- [x] æ·»åŠ  SSR ä¿æŠ¤
- [x] æ„å»ºæˆåŠŸ
- [x] éƒ¨ç½²åˆ° gh-pages
- [x] æäº¤åˆ° main

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

è®¿é—®ç½‘ç«™åï¼Œå®Œæ•´çš„äº¤äº’æµç¨‹ï¼š

```
1. çœ‹åˆ°è“ç´«è‰²æ¼”ç¤ºåŒºåŸŸ
   â†“
2. ä¸¤ä¸ªè¾“å…¥æ¡† + ä¸€ä¸ªæŒ‰é’®
   â†“
3. ç‚¹å‡» "ğŸ”’ è®¡ç®—éšç§äº¤é›†"
   â†“
4. æŒ‰é’®æ–‡å­—å˜ä¸º "â³ è®¡ç®—ä¸­..."
   â†“
5. 1 ç§’åæ˜¾ç¤ºç»“æœ
   - å…±åŒæ‚£è€… ID
   - å…±åŒæ‚£è€…æ•°é‡
   - éšç§ä¿æŠ¤è¯´æ˜
   - åŠ å¯†è¿‡ç¨‹ï¼ˆå“ˆå¸Œï¼‰
   â†“
6. æŒ‰é’®æ¢å¤ "ğŸ”’ è®¡ç®—éšç§äº¤é›†"
   â†“
7. å¯ä»¥å†æ¬¡ç‚¹å‡»
```

---

## âœ… æœ€ç»ˆç¡®è®¤æ¸…å•

è®¿é—®ç½‘ç«™åé€é¡¹ç¡®è®¤ï¼š

### é¡µé¢æ˜¾ç¤º
- [ ] èƒ½çœ‹åˆ°è“ç´«è‰²èƒŒæ™¯çš„æ¼”ç¤ºåŒºåŸŸ
- [ ] èƒ½çœ‹åˆ°æ ‡é¢˜ "ğŸ¥ åŒ»ç–—åœºæ™¯ PSI æ¼”ç¤º"
- [ ] èƒ½çœ‹åˆ°ä¸¤ä¸ªè¾“å…¥æ¡†
- [ ] èƒ½çœ‹åˆ° "ğŸ”’ è®¡ç®—éšç§äº¤é›†" æŒ‰é’®

### äº¤äº’åŠŸèƒ½
- [ ] è¾“å…¥æ¡†å¯ä»¥ç¼–è¾‘
- [ ] ç‚¹å‡»æŒ‰é’®æœ‰ååº”ï¼ˆæ–‡å­—å˜åŒ–ï¼‰
- [ ] 1 ç§’åæ˜¾ç¤ºç»“æœ
- [ ] æ˜¾ç¤ºå…±åŒæ‚£è€… ID
- [ ] æ˜¾ç¤ºå…±åŒæ‚£è€…æ•°é‡
- [ ] æ˜¾ç¤ºåŠ å¯†è¿‡ç¨‹
- [ ] æŒ‰é’®å¯ä»¥é‡å¤ç‚¹å‡»

### æ§åˆ¶å°æ£€æŸ¥
- [ ] æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°
- [ ] Console æ ‡ç­¾é¡µæ— çº¢è‰²é”™è¯¯
- [ ] ç‚¹å‡»æŒ‰é’®åæ— æŠ¥é”™

---

## ğŸŠ å¤§åŠŸå‘Šæˆï¼

**ç­‰å¾… 2-3 åˆ†é’Ÿåè®¿é—®ç½‘ç«™æµ‹è¯•å§ï¼** ğŸš€

```
https://paopaotai.github.io/secretflow-demo/tech/
```

**è¿™æ¬¡æŒ‰é’®åº”è¯¥èƒ½æ­£å¸¸ç‚¹å‡»äº†ï¼** âœ¨

**å®Œæ•´äº¤äº’æµç¨‹**ï¼š
1. ä¿®æ”¹æ•°æ®ï¼ˆå¯é€‰ï¼‰
2. ç‚¹å‡»æŒ‰é’®
3. æŸ¥çœ‹ç»“æœ
4. æŸ¥çœ‹åŠ å¯†è¿‡ç¨‹

**å¦‚æœè¿˜æœ‰é—®é¢˜**ï¼š
1. å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+Shift+Rï¼‰
2. æ¸…é™¤ç¼“å­˜
3. æ‰“å¼€æ§åˆ¶å°çœ‹é”™è¯¯ä¿¡æ¯
4. æˆªå›¾ç»™æˆ‘

**æ­å–œå®Œæˆ Day1 & Day2 æ‰€æœ‰ä»»åŠ¡ï¼** ğŸ‰ğŸ‰ğŸ‰


