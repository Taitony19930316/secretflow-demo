import{_ as s,c as a,b as t,o as p}from"./app-B3w0Vqk4.js";const e={};function o(l,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h1 id="🎉-交互按钮最终修复完成" tabindex="-1"><a class="header-anchor" href="#🎉-交互按钮最终修复完成"><span>🎉 交互按钮最终修复完成</span></a></h1><hr><h2 id="❌-问题根源" tabindex="-1"><a class="header-anchor" href="#❌-问题根源"><span>❌ 问题根源</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ReferenceError: runPSI is not defined</span>
<span class="line">at HTMLButtonElement.onclick (tech/:1:1)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>原因</strong>：JavaScript 函数 <code>runPSI</code> 没有被正确定义到全局作用域。</p><hr><h2 id="🔍-问题详解" tabindex="-1"><a class="header-anchor" href="#🔍-问题详解"><span>🔍 问题详解</span></a></h2><h3 id="vuepress-的作用域问题" tabindex="-1"><a class="header-anchor" href="#vuepress-的作用域问题"><span>VuePress 的作用域问题</span></a></h3><p>在 Markdown 文件中直接写的 <code>&lt;script&gt;</code> 标签，里面定义的函数默认<strong>不在全局作用域</strong>中。</p><h4 id="原来的代码-❌-错误" tabindex="-1"><a class="header-anchor" href="#原来的代码-❌-错误"><span>原来的代码（❌ 错误）</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runPSI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ... 函数内容</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>问题</strong>：</p><ul><li>这个函数只在当前模块作用域中</li><li><code>onclick=&quot;runPSI()&quot;</code> 在全局作用域查找，找不到</li></ul><h3 id="html-onclick-的作用域" tabindex="-1"><a class="header-anchor" href="#html-onclick-的作用域"><span>HTML onclick 的作用域</span></a></h3><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">runPSI</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>计算<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>onclick</code> 属性中的代码在<strong>全局作用域</strong>执行</li><li>需要函数挂载到 <code>window</code> 对象上</li></ul><hr><h2 id="✅-解决方案" tabindex="-1"><a class="header-anchor" href="#✅-解决方案"><span>✅ 解决方案</span></a></h2><h3 id="_1-将函数挂载到-window-对象" tabindex="-1"><a class="header-anchor" href="#_1-将函数挂载到-window-对象"><span>1. 将函数挂载到 window 对象</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ... 函数内容</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-添加-ssr-保护" tabindex="-1"><a class="header-anchor" href="#_2-添加-ssr-保护"><span>2. 添加 SSR 保护</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 只在浏览器环境执行</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ... 函数内容</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为什么需要</strong>：</p><ul><li>VuePress 构建时会进行 SSR（服务端渲染）</li><li>Node.js 环境没有 <code>window</code> 对象</li><li>需要跳过 SSR，只在浏览器端执行</li></ul><hr><h2 id="📝-最终代码" tabindex="-1"><a class="header-anchor" href="#📝-最终代码"><span>📝 最终代码</span></a></h2><h3 id="修改后的完整代码" tabindex="-1"><a class="header-anchor" href="#修改后的完整代码"><span>修改后的完整代码</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// SHA-256 哈希函数</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> msgBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hashBuffer <span class="token operator">=</span> <span class="token keyword">await</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&#39;SHA-256&#39;</span><span class="token punctuation">,</span> msgBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hashArray <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>hashBuffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> hashArray<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 运行 PSI（挂载到全局）</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> button <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">;</span></span>
<span class="line">    button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">&#39;⏳ 计算中...&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    button<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 获取输入</span></span>
<span class="line">    <span class="token keyword">const</span> hospitalAInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;hospital-a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hospitalBInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;hospital-b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hospitalA <span class="token operator">=</span> hospitalAInput<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hospitalB <span class="token operator">=</span> hospitalBInput<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 模拟加密过程</span></span>
<span class="line">    <span class="token keyword">const</span> hashedA <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>hospitalA<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token function">sha256</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hashedB <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>hospitalB<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token function">sha256</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 计算交集</span></span>
<span class="line">    <span class="token keyword">const</span> intersection <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hospitalA<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      hashMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>hashedA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> hospitalA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hospitalB<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>hashMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>hashedB<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        intersection<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>hospitalB<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 显示结果</span></span>
<span class="line">    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;intersection-result&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> </span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;strong&gt;共同患者 ID：&lt;/strong&gt;&lt;span&gt;[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>intersection<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]&lt;/span&gt;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;count-result&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> </span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;strong&gt;共同患者数量：&lt;/strong&gt;&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>intersection<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 显示加密细节</span></span>
<span class="line">    <span class="token keyword">let</span> hashDetails <span class="token operator">=</span> <span class="token string">&#39;&lt;div&gt;&lt;strong&gt;医院 A 的哈希：&lt;/strong&gt;&lt;/div&gt;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    hospitalA<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      hashDetails <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> → </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hashedA<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...&lt;/div&gt;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    hashDetails <span class="token operator">+=</span> <span class="token string">&#39;&lt;div&gt;&lt;strong&gt;医院 B 的哈希：&lt;/strong&gt;&lt;/div&gt;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    hospitalB<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      hashDetails <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&lt;div&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> → </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hashedB<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...&lt;/div&gt;</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;hash-content&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hashDetails<span class="token punctuation">;</span></span>
<span class="line">    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;psi-result&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 恢复按钮</span></span>
<span class="line">    button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">&#39;🔒 计算隐私交集&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    button<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 按钮悬停效果</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;DOMContentLoaded&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#psi-demo button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>button<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseover&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#39;translateY(-2px)&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>boxShadow <span class="token operator">=</span> <span class="token string">&#39;0 5px 20px rgba(102, 126, 234, 0.4)&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseout&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#39;translateY(0)&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>boxShadow <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🔑-关键改动" tabindex="-1"><a class="header-anchor" href="#🔑-关键改动"><span>🔑 关键改动</span></a></h2><h3 id="_1-包裹整个代码块" tabindex="-1"><a class="header-anchor" href="#_1-包裹整个代码块"><span>1. 包裹整个代码块</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 所有浏览器端代码</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-挂载到-window" tabindex="-1"><a class="header-anchor" href="#_2-挂载到-window"><span>2. 挂载到 window</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>不是：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runPSI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>  <span class="token comment">// ❌ 不在全局作用域</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-sha256-函数可以不挂载" tabindex="-1"><a class="header-anchor" href="#_3-sha256-函数可以不挂载"><span>3. sha256 函数可以不挂载</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>为什么</strong>：</p><ul><li><code>sha256</code> 只在 <code>runPSI</code> 内部调用</li><li>不需要全局访问</li><li>保持在闭包内即可</li></ul><hr><h2 id="🌐-访问测试-等待-2-3-分钟" tabindex="-1"><a class="header-anchor" href="#🌐-访问测试-等待-2-3-分钟"><span>🌐 访问测试（等待 2-3 分钟）</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">https://paopaotai.github.io/secretflow-demo/tech/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="🧪-测试步骤" tabindex="-1"><a class="header-anchor" href="#🧪-测试步骤"><span>🧪 测试步骤</span></a></h2><h3 id="_1-等待-2-3-分钟-github-pages-更新" tabindex="-1"><a class="header-anchor" href="#_1-等待-2-3-分钟-github-pages-更新"><span>1. 等待 2-3 分钟（GitHub Pages 更新）</span></a></h3><h3 id="_2-访问网站并强制刷新" tabindex="-1"><a class="header-anchor" href="#_2-访问网站并强制刷新"><span>2. 访问网站并强制刷新</span></a></h3><ul><li>Windows: <code>Ctrl + Shift + R</code></li><li>Mac: <code>Cmd + Shift + R</code></li></ul><h3 id="_3-找到蓝紫色演示区域" tabindex="-1"><a class="header-anchor" href="#_3-找到蓝紫色演示区域"><span>3. 找到蓝紫色演示区域</span></a></h3><p>应该看到：</p><ul><li>两个输入框（医院 A 和 B）</li><li>大按钮 &quot;🔒 计算隐私交集&quot;</li></ul><h3 id="_4-测试交互" tabindex="-1"><a class="header-anchor" href="#_4-测试交互"><span>4. 测试交互</span></a></h3><p><strong>操作流程</strong>：</p><ol><li>修改输入框的数据（可选）</li><li><strong>点击按钮</strong></li><li>按钮文字应该变为 &quot;⏳ 计算中...&quot;</li><li>1 秒后显示结果： <ul><li>共同患者 ID：[1002, 1003]</li><li>共同患者数量：2</li><li>隐私保护说明</li><li>加密过程（哈希值）</li></ul></li></ol><h3 id="_5-打开控制台确认无错误" tabindex="-1"><a class="header-anchor" href="#_5-打开控制台确认无错误"><span>5. 打开控制台确认无错误</span></a></h3><p>按 <code>F12</code> → Console 标签页：</p><ul><li>✅ 应该<strong>没有红色错误</strong></li><li>✅ 点击按钮后应该能看到结果</li></ul><hr><h2 id="📊-问题解决历程" tabindex="-1"><a class="header-anchor" href="#📊-问题解决历程"><span>📊 问题解决历程</span></a></h2><table><thead><tr><th>尝试</th><th>方法</th><th>结果</th><th>原因</th></tr></thead><tbody><tr><td>第1次</td><td>复杂 HTML 格式</td><td>❌ 显示代码文本</td><td>Markdown 解析问题</td></tr><tr><td>第2次</td><td>使用 <code>&lt;ClientOnly&gt;</code></td><td>❌ 整个区域空白</td><td>VuePress bug</td></tr><tr><td>第3次</td><td>移除 <code>&lt;ClientOnly&gt;</code></td><td>✅ 显示正常</td><td>❌ 按钮点不了</td></tr><tr><td>第4次</td><td><code>window.runPSI = ...</code></td><td>❌ SSR 报错</td><td>缺少环境检查</td></tr><tr><td>第5次</td><td><code>if (typeof window)</code> + <code>window.runPSI</code></td><td>✅ <strong>完美解决</strong></td><td>✅</td></tr></tbody></table><hr><h2 id="💡-技术总结" tabindex="-1"><a class="header-anchor" href="#💡-技术总结"><span>💡 技术总结</span></a></h2><h3 id="在-vuepress-中使用交互元素的最佳实践" tabindex="-1"><a class="header-anchor" href="#在-vuepress-中使用交互元素的最佳实践"><span>在 VuePress 中使用交互元素的最佳实践</span></a></h3><h4 id="_1-全局函数必须挂载到-window" tabindex="-1"><a class="header-anchor" href="#_1-全局函数必须挂载到-window"><span>1. <strong>全局函数必须挂载到 window</strong></span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// ❌ 错误</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ✅ 正确</span></span>
<span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-所有浏览器代码都要检查环境" tabindex="-1"><a class="header-anchor" href="#_2-所有浏览器代码都要检查环境"><span>2. <strong>所有浏览器代码都要检查环境</strong></span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// ✅ 正确</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 浏览器端代码</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-onclick-的替代方案" tabindex="-1"><a class="header-anchor" href="#_3-onclick-的替代方案"><span>3. <strong>onclick 的替代方案</strong></span></a></h4><p>如果不想用 <code>onclick</code> 属性，可以用事件监听：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;DOMContentLoaded&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;my-button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 处理点击</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但这样按钮就需要有 <code>id</code>：</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre><code class="language-html"><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_4-避免使用-clientonly" tabindex="-1"><a class="header-anchor" href="#_4-避免使用-clientonly"><span>4. <strong>避免使用 ClientOnly</strong></span></a></h4><ul><li>VuePress 2.x 的 <code>&lt;ClientOnly&gt;</code> 有已知问题</li><li>特别是包含 <code>&lt;script&gt;</code> 时不稳定</li><li>直接用 <code>if (typeof window)</code> 更可靠</li></ul><hr><h2 id="🚀-部署完成" tabindex="-1"><a class="header-anchor" href="#🚀-部署完成"><span>🚀 部署完成</span></a></h2><ul><li>[x] 代码已修复（挂载到 window）</li><li>[x] 添加 SSR 保护</li><li>[x] 构建成功</li><li>[x] 部署到 gh-pages</li><li>[x] 提交到 main</li></ul><hr><h2 id="🎯-预期效果" tabindex="-1"><a class="header-anchor" href="#🎯-预期效果"><span>🎯 预期效果</span></a></h2><p>访问网站后，完整的交互流程：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">1. 看到蓝紫色演示区域</span>
<span class="line">   ↓</span>
<span class="line">2. 两个输入框 + 一个按钮</span>
<span class="line">   ↓</span>
<span class="line">3. 点击 &quot;🔒 计算隐私交集&quot;</span>
<span class="line">   ↓</span>
<span class="line">4. 按钮文字变为 &quot;⏳ 计算中...&quot;</span>
<span class="line">   ↓</span>
<span class="line">5. 1 秒后显示结果</span>
<span class="line">   - 共同患者 ID</span>
<span class="line">   - 共同患者数量</span>
<span class="line">   - 隐私保护说明</span>
<span class="line">   - 加密过程（哈希）</span>
<span class="line">   ↓</span>
<span class="line">6. 按钮恢复 &quot;🔒 计算隐私交集&quot;</span>
<span class="line">   ↓</span>
<span class="line">7. 可以再次点击</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="✅-最终确认清单" tabindex="-1"><a class="header-anchor" href="#✅-最终确认清单"><span>✅ 最终确认清单</span></a></h2><p>访问网站后逐项确认：</p><h3 id="页面显示" tabindex="-1"><a class="header-anchor" href="#页面显示"><span>页面显示</span></a></h3><ul><li>[ ] 能看到蓝紫色背景的演示区域</li><li>[ ] 能看到标题 &quot;🏥 医疗场景 PSI 演示&quot;</li><li>[ ] 能看到两个输入框</li><li>[ ] 能看到 &quot;🔒 计算隐私交集&quot; 按钮</li></ul><h3 id="交互功能" tabindex="-1"><a class="header-anchor" href="#交互功能"><span>交互功能</span></a></h3><ul><li>[ ] 输入框可以编辑</li><li>[ ] 点击按钮有反应（文字变化）</li><li>[ ] 1 秒后显示结果</li><li>[ ] 显示共同患者 ID</li><li>[ ] 显示共同患者数量</li><li>[ ] 显示加密过程</li><li>[ ] 按钮可以重复点击</li></ul><h3 id="控制台检查" tabindex="-1"><a class="header-anchor" href="#控制台检查"><span>控制台检查</span></a></h3><ul><li>[ ] 按 F12 打开控制台</li><li>[ ] Console 标签页无红色错误</li><li>[ ] 点击按钮后无报错</li></ul><hr><h2 id="🎊-大功告成" tabindex="-1"><a class="header-anchor" href="#🎊-大功告成"><span>🎊 大功告成！</span></a></h2><p><strong>等待 2-3 分钟后访问网站测试吧！</strong> 🚀</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">https://paopaotai.github.io/secretflow-demo/tech/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>这次按钮应该能正常点击了！</strong> ✨</p><p><strong>完整交互流程</strong>：</p><ol><li>修改数据（可选）</li><li>点击按钮</li><li>查看结果</li><li>查看加密过程</li></ol><p><strong>如果还有问题</strong>：</p><ol><li>强制刷新（Ctrl+Shift+R）</li><li>清除缓存</li><li>打开控制台看错误信息</li><li>截图给我</li></ol><p><strong>恭喜完成 Day1 &amp; Day2 所有任务！</strong> 🎉🎉🎉</p>`,100)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/devlog/troubleshooting/%F0%9F%8E%89%E4%BA%A4%E4%BA%92%E6%8C%89%E9%92%AE%E6%9C%80%E7%BB%88%E4%BF%AE%E5%A4%8D.html","title":"🎉 交互按钮最终修复完成","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1761803161000,"contributors":[{"name":"tailunyu","username":"tailunyu","email":"tailunyu@example.com","commits":1,"url":"https://github.com/tailunyu"}],"changelog":[{"hash":"6ef86c47225087bdb49e72347ae00f4edeae475d","time":1761803161000,"email":"tailunyu@example.com","author":"tailunyu","message":"扩展开发手记：添加技术原理、部署指南、问题解决、开发总结四大分类（移除敏感信息）"}]},"filePathRelative":"devlog/troubleshooting/🎉交互按钮最终修复.md"}');export{i as comp,u as data};
