<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>💡 为什么环境检查能解决 SSR 报错？ | 隐语交互式拆解站</title><meta name="description" content="隐私计算技术演示与场景交互">
    <link rel="preload" href="/secretflow-demo/assets/style-BAFN6eoG.css" as="style"><link rel="stylesheet" href="/secretflow-demo/assets/style-BAFN6eoG.css">
    <link rel="modulepreload" href="/secretflow-demo/assets/app-B3w0Vqk4.js"><link rel="modulepreload" href="/secretflow-demo/assets/💡SSR原理详解.html-DW7g3Ko-.js">
    <link rel="prefetch" href="/secretflow-demo/assets/index.html-D5JTdkwK.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/index.html-BXptWNLt.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/index.html-Bpjz4N2Q.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/index.html-CPD3EkGs.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/Colab部署指南.html-CA8PAHsx.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/GitHub-Pages域名规则和自定义域名.html-oI72-Z6r.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/🌐Cloudflare-Pages部署-替代方案.html-CTtM8GN5.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/🚀Gitee部署指南-国内访问.html-yZRx89jo.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/Day1-进度记录.html-DSSzfBt2.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/🎉Day1-2完成总结.html-COAYePEa.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/📋新7天攻坚计划-打造完整隐语平台.html-ClYvtio2.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/PSI密码学技术详解.html-y_Y6m3Y_.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/为什么不用SecretFlow也能运行PSI.html-sZliRVsO.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/什么是部署-完整解释.html-B6Y4Yqw0.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/从域名到文件的完整链路.html-DPFOJdOR.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/在网页端演示PSI的方案.html-BhALQz2H.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/Colab正确操作指南.html-BBpnVkaS.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/Colab运行故障排查.html-CbgjT60h.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/✨显示效果优化完成.html-C-vHOym1.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/🎉交互按钮最终修复.html--zYvMJLN.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/📐导航结构优化完成.html-Euql-vpl.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/🔧HTML显示问题修复完成.html-pkN94TFz.js" as="script"><link rel="prefetch" href="/secretflow-demo/assets/404.html-Dq4CKyV5.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/secretflow-demo/"><!----><span class="vp-site-name" aria-hidden="true">隐语交互式拆解站</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/secretflow-demo/tech/" aria-label="PSI"><!--[--><!--[--><!--]--><!--]-->PSI<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/secretflow-demo/mpc/" aria-label="MPC"><!--[--><!--[--><!--]--><!--]-->MPC<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/secretflow-demo/devlog/" aria-label="开发手记"><!--[--><!--[--><!--]--><!--]-->开发手记<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/secretflow-demo/tech/" aria-label="PSI"><!--[--><!--[--><!--]--><!--]-->PSI<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/secretflow-demo/mpc/" aria-label="MPC"><!--[--><!--[--><!--]--><!--]-->MPC<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/secretflow-demo/devlog/" aria-label="开发手记"><!--[--><!--[--><!--]--><!--]-->开发手记<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading" href="/secretflow-demo/devlog/" aria-label="开发手记"><!--[--><!--[--><!--]--><!--]-->开发手记<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">📚 技术原理 <span class="down arrow"></span></p><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/tech-principles/PSI%E5%AF%86%E7%A0%81%E5%AD%A6%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3.html" aria-label="PSI 密码学技术详解"><!--[--><!--[--><!--]--><!--]-->PSI 密码学技术详解<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/secretflow-demo/devlog/tech-principles/%F0%9F%92%A1SSR%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3.html" aria-label="💡 为什么环境检查能解决 SSR 报错？"><!--[--><!--[--><!--]--><!--]-->💡 为什么环境检查能解决 SSR 报错？<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/tech-principles/%E4%BB%8E%E5%9F%9F%E5%90%8D%E5%88%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%8C%E6%95%B4%E9%93%BE%E8%B7%AF.html" aria-label="从域名到文件的完整链路"><!--[--><!--[--><!--]--><!--]-->从域名到文件的完整链路<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/tech-principles/%E4%BB%80%E4%B9%88%E6%98%AF%E9%83%A8%E7%BD%B2-%E5%AE%8C%E6%95%B4%E8%A7%A3%E9%87%8A.html" aria-label="什么是部署？为什么需要部署？"><!--[--><!--[--><!--]--><!--]-->什么是部署？为什么需要部署？<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/tech-principles/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E7%94%A8SecretFlow%E4%B9%9F%E8%83%BD%E8%BF%90%E8%A1%8CPSI.html" aria-label="为什么不用 SecretFlow SDK 也能运行 PSI？"><!--[--><!--[--><!--]--><!--]-->为什么不用 SecretFlow SDK 也能运行 PSI？<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/tech-principles/%E5%9C%A8%E7%BD%91%E9%A1%B5%E7%AB%AF%E6%BC%94%E7%A4%BAPSI%E7%9A%84%E6%96%B9%E6%A1%88.html" aria-label="在网页端演示 PSI 的可行方案"><!--[--><!--[--><!--]--><!--]-->在网页端演示 PSI 的可行方案<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">🚀 部署指南 <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/deployment/%F0%9F%9A%80Gitee%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97-%E5%9B%BD%E5%86%85%E8%AE%BF%E9%97%AE.html" aria-label="🚀 Gitee Pages 部署指南 - 解决国内访问问题"><!--[--><!--[--><!--]--><!--]-->🚀 Gitee Pages 部署指南 - 解决国内访问问题<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/deployment/%F0%9F%8C%90Cloudflare-Pages%E9%83%A8%E7%BD%B2-%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88.html" aria-label="🌐 Cloudflare Pages 部署指南 - Gitee 的完美替代"><!--[--><!--[--><!--]--><!--]-->🌐 Cloudflare Pages 部署指南 - Gitee 的完美替代<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/deployment/Colab%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97.html" aria-label="Google Colab 部署指南"><!--[--><!--[--><!--]--><!--]-->Google Colab 部署指南<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/deployment/GitHub-Pages%E5%9F%9F%E5%90%8D%E8%A7%84%E5%88%99%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D.html" aria-label="GitHub Pages 域名规则和自定义域名"><!--[--><!--[--><!--]--><!--]-->GitHub Pages 域名规则和自定义域名<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">🔧 问题解决 <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/troubleshooting/%F0%9F%94%A7HTML%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E5%AE%8C%E6%88%90.html" aria-label="🔧 HTML 显示问题修复完成"><!--[--><!--[--><!--]--><!--]-->🔧 HTML 显示问题修复完成<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/troubleshooting/%F0%9F%8E%89%E4%BA%A4%E4%BA%92%E6%8C%89%E9%92%AE%E6%9C%80%E7%BB%88%E4%BF%AE%E5%A4%8D.html" aria-label="🎉 交互按钮最终修复完成"><!--[--><!--[--><!--]--><!--]-->🎉 交互按钮最终修复完成<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/troubleshooting/%F0%9F%93%90%E5%AF%BC%E8%88%AA%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96%E5%AE%8C%E6%88%90.html" aria-label="📐 导航结构优化完成"><!--[--><!--[--><!--]--><!--]-->📐 导航结构优化完成<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/troubleshooting/%E2%9C%A8%E6%98%BE%E7%A4%BA%E6%95%88%E6%9E%9C%E4%BC%98%E5%8C%96%E5%AE%8C%E6%88%90.html" aria-label="✨ 显示效果优化完成"><!--[--><!--[--><!--]--><!--]-->✨ 显示效果优化完成<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/troubleshooting/Colab%E8%BF%90%E8%A1%8C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5.html" aria-label="🔧 Colab 运行故障排查"><!--[--><!--[--><!--]--><!--]-->🔧 Colab 运行故障排查<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/troubleshooting/Colab%E6%AD%A3%E7%A1%AE%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97.html" aria-label="📚 Google Colab 正确操作指南"><!--[--><!--[--><!--]--><!--]-->📚 Google Colab 正确操作指南<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">📊 开发总结 <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/summary/%F0%9F%8E%89Day1-2%E5%AE%8C%E6%88%90%E6%80%BB%E7%BB%93.html" aria-label="🎉 Day1-2 完成总结与Day3启动"><!--[--><!--[--><!--]--><!--]-->🎉 Day1-2 完成总结与Day3启动<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/summary/Day1-%E8%BF%9B%E5%BA%A6%E8%AE%B0%E5%BD%95.html" aria-label="Day 1 进度记录"><!--[--><!--[--><!--]--><!--]-->Day 1 进度记录<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/secretflow-demo/devlog/summary/%F0%9F%93%8B%E6%96%B07%E5%A4%A9%E6%94%BB%E5%9D%9A%E8%AE%A1%E5%88%92-%E6%89%93%E9%80%A0%E5%AE%8C%E6%95%B4%E9%9A%90%E8%AF%AD%E5%B9%B3%E5%8F%B0.html" aria-label="📋 新7天攻坚计划 - 打造完整隐语交互式学习平台"><!--[--><!--[--><!--]--><!--]-->📋 新7天攻坚计划 - 打造完整隐语交互式学习平台<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="💡-为什么环境检查能解决-ssr-报错" tabindex="-1"><a class="header-anchor" href="#💡-为什么环境检查能解决-ssr-报错"><span>💡 为什么环境检查能解决 SSR 报错？</span></a></h1><hr><h2 id="🤔-问题回顾" tabindex="-1"><a class="header-anchor" href="#🤔-问题回顾"><span>🤔 问题回顾</span></a></h2><h3 id="报错信息" tabindex="-1"><a class="header-anchor" href="#报错信息"><span>报错信息</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">ReferenceError: window is not defined</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案"><span>解决方案</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 代码</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为什么加一个判断就行了？</strong></p><hr><h2 id="📚-核心概念" tabindex="-1"><a class="header-anchor" href="#📚-核心概念"><span>📚 核心概念</span></a></h2><h3 id="_1-什么是-ssr-服务端渲染" tabindex="-1"><a class="header-anchor" href="#_1-什么是-ssr-服务端渲染"><span>1. 什么是 SSR（服务端渲染）？</span></a></h3><p>SSR = Server-Side Rendering（服务端渲染）</p><h4 id="传统的客户端渲染-csr" tabindex="-1"><a class="header-anchor" href="#传统的客户端渲染-csr"><span>传统的客户端渲染（CSR）</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">浏览器请求</span>
<span class="line">    ↓</span>
<span class="line">服务器返回空白 HTML + JavaScript</span>
<span class="line">    ↓</span>
<span class="line">浏览器下载 JavaScript</span>
<span class="line">    ↓</span>
<span class="line">JavaScript 执行，动态生成内容</span>
<span class="line">    ↓</span>
<span class="line">用户看到页面（慢）</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>缺点</strong>：</p><ul><li>首屏加载慢</li><li>SEO 不友好（搜索引擎看不到内容）</li><li>白屏时间长</li></ul><h4 id="服务端渲染-ssr" tabindex="-1"><a class="header-anchor" href="#服务端渲染-ssr"><span>服务端渲染（SSR）</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">浏览器请求</span>
<span class="line">    ↓</span>
<span class="line">服务器用 Node.js 执行代码，生成完整 HTML</span>
<span class="line">    ↓</span>
<span class="line">服务器返回完整 HTML</span>
<span class="line">    ↓</span>
<span class="line">用户立即看到内容（快）</span>
<span class="line">    ↓</span>
<span class="line">浏览器下载 JavaScript，激活交互</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>优点</strong>：</p><ul><li>首屏加载快</li><li>SEO 友好</li><li>无白屏</li></ul><hr><h2 id="🏗️-vuepress-的构建过程" tabindex="-1"><a class="header-anchor" href="#🏗️-vuepress-的构建过程"><span>🏗️ VuePress 的构建过程</span></a></h2><h3 id="vuepress-2-x-构建流程" tabindex="-1"><a class="header-anchor" href="#vuepress-2-x-构建流程"><span>VuePress 2.x 构建流程</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">1. 读取 Markdown 文件</span>
<span class="line">   ↓</span>
<span class="line">2. 转换为 Vue 组件</span>
<span class="line">   ↓</span>
<span class="line">3. 【SSR 阶段】在 Node.js 中执行，生成 HTML</span>
<span class="line">   ↓</span>
<span class="line">4. 输出静态 HTML 文件</span>
<span class="line">   ↓</span>
<span class="line">5. 部署到服务器</span>
<span class="line">   ↓</span>
<span class="line">6. 【CSR 阶段】用户访问时，浏览器激活交互</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="关键点-两个不同的环境" tabindex="-1"><a class="header-anchor" href="#关键点-两个不同的环境"><span>关键点：两个不同的环境</span></a></h3><table><thead><tr><th>环境</th><th>阶段</th><th>运行在</th><th>有 window 吗？</th><th>有 document 吗？</th></tr></thead><tbody><tr><td><strong>Node.js</strong></td><td>构建时（SSR）</td><td>服务器</td><td>❌ 没有</td><td>❌ 没有</td></tr><tr><td><strong>浏览器</strong></td><td>运行时（CSR）</td><td>客户端</td><td>✅ 有</td><td>✅ 有</td></tr></tbody></table><hr><h2 id="⚠️-为什么会报错" tabindex="-1"><a class="header-anchor" href="#⚠️-为什么会报错"><span>⚠️ 为什么会报错？</span></a></h2><h3 id="问题代码" tabindex="-1"><a class="header-anchor" href="#问题代码"><span>问题代码</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="执行过程" tabindex="-1"><a class="header-anchor" href="#执行过程"><span>执行过程</span></a></h3><h4 id="第1步-构建时-node-js-环境" tabindex="-1"><a class="header-anchor" href="#第1步-构建时-node-js-环境"><span>第1步：构建时（Node.js 环境）</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// VuePress 在 Node.js 中执行这段代码</span></span>
<span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line">        ↑</span>
<span class="line">      这里报错！</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为什么报错</strong>：</p><ul><li>Node.js 是服务器端 JavaScript 运行环境</li><li>Node.js <strong>没有</strong> <code>window</code> 对象</li><li>Node.js 只有 <code>global</code> 对象</li></ul><p><strong>类比</strong>：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">就像在 Python 中调用 JavaScript 的函数</span>
<span class="line">→ Python 说：&quot;我不认识 window 这个东西！&quot;</span>
<span class="line">→ ReferenceError: window is not defined</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第2步-运行时-浏览器环境" tabindex="-1"><a class="header-anchor" href="#第2步-运行时-浏览器环境"><span>第2步：运行时（浏览器环境）</span></a></h4><p>如果代码能通过构建，到浏览器就正常了：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 浏览器中执行</span></span>
<span class="line">window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line">        ↑</span>
<span class="line">      浏览器有 window，正常</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="✅-为什么检查能解决问题" tabindex="-1"><a class="header-anchor" href="#✅-为什么检查能解决问题"><span>✅ 为什么检查能解决问题？</span></a></h2><h3 id="解决方案代码" tabindex="-1"><a class="header-anchor" href="#解决方案代码"><span>解决方案代码</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="执行过程详解" tabindex="-1"><a class="header-anchor" href="#执行过程详解"><span>执行过程详解</span></a></h3><h4 id="构建时-node-js-环境" tabindex="-1"><a class="header-anchor" href="#构建时-node-js-环境"><span>构建时（Node.js 环境）</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 第1步：检查 window 是否存在</span></span>
<span class="line"><span class="token keyword">typeof</span> window</span>
<span class="line"><span class="token comment">// 在 Node.js 中，window 未定义</span></span>
<span class="line"><span class="token comment">// typeof 对未定义的变量不会报错，返回 &#39;undefined&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 第2步：判断</span></span>
<span class="line"><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span>  <span class="token comment">// &#39;undefined&#39; !== &#39;undefined&#39;</span></span>
<span class="line">                                <span class="token comment">// false</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 第3步：不执行 if 块内的代码</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 这里的代码不会执行，跳过！</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>  <span class="token comment">// 不执行，不报错</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>关键</strong>：<code>typeof</code> 是安全的运算符，对未定义的变量也不会报错。</p><h4 id="运行时-浏览器环境" tabindex="-1"><a class="header-anchor" href="#运行时-浏览器环境"><span>运行时（浏览器环境）</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 第1步：检查 window 是否存在</span></span>
<span class="line"><span class="token keyword">typeof</span> window</span>
<span class="line"><span class="token comment">// 在浏览器中，window 存在</span></span>
<span class="line"><span class="token comment">// 返回 &#39;object&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 第2步：判断</span></span>
<span class="line"><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span>  <span class="token comment">// &#39;object&#39; !== &#39;undefined&#39;</span></span>
<span class="line">                                <span class="token comment">// true</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 第3步：执行 if 块内的代码</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 浏览器中执行这里的代码</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">runPSI</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>  <span class="token comment">// 正常挂载</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🔬-深入理解-typeof-的特殊性" tabindex="-1"><a class="header-anchor" href="#🔬-深入理解-typeof-的特殊性"><span>🔬 深入理解：typeof 的特殊性</span></a></h2><h3 id="为什么用-typeof" tabindex="-1"><a class="header-anchor" href="#为什么用-typeof"><span>为什么用 typeof？</span></a></h3><h4 id="❌-错误的检查方式" tabindex="-1"><a class="header-anchor" href="#❌-错误的检查方式"><span>❌ 错误的检查方式</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 错误 1：直接检查</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>window <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 构建时这里就会报错！</span></span>
<span class="line">  <span class="token comment">// ReferenceError: window is not defined</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 错误 2：检查是否存在</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 同样报错</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为什么错误</strong>：</p><ul><li>在判断 <code>window !== undefined</code> 之前</li><li>JavaScript 需要先<strong>访问</strong> <code>window</code> 变量</li><li>但 Node.js 中 <code>window</code> 根本不存在</li><li>访问时就报错了</li></ul><h4 id="✅-正确的检查方式" tabindex="-1"><a class="header-anchor" href="#✅-正确的检查方式"><span>✅ 正确的检查方式</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 正确</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>为什么正确</strong>：</p><ul><li><code>typeof</code> 是 JavaScript 的<strong>运算符</strong>，不是函数</li><li><code>typeof</code> 对<strong>未定义的变量</strong>也能正常工作</li><li>不会抛出 ReferenceError</li></ul><h3 id="typeof-的特殊行为" tabindex="-1"><a class="header-anchor" href="#typeof-的特殊行为"><span>typeof 的特殊行为</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 未定义的变量</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>notExist<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// ❌ ReferenceError</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> notExist<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ✅ &#39;undefined&#39;（不报错）</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 这是 typeof 的特殊设计</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🌍-两个世界的隔离" tabindex="-1"><a class="header-anchor" href="#🌍-两个世界的隔离"><span>🌍 两个世界的隔离</span></a></h2><h3 id="node-js-世界-服务器端" tabindex="-1"><a class="header-anchor" href="#node-js-世界-服务器端"><span>Node.js 世界（服务器端）</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Node.js 的全局对象</span></span>
<span class="line">global<span class="token punctuation">.</span>myVar <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 没有浏览器 API</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#39;undefined&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#39;undefined&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> localStorage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;undefined&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能报错</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 但有 Node.js API</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> require<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#39;function&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> process<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#39;object&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> __dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#39;string&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="浏览器世界-客户端" tabindex="-1"><a class="header-anchor" href="#浏览器世界-客户端"><span>浏览器世界（客户端）</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 浏览器的全局对象</span></span>
<span class="line">window<span class="token punctuation">.</span>myVar <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 有浏览器 API</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#39;object&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#39;object&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> localStorage<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;object&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;object&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 但没有 Node.js API</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> require<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#39;undefined&#39;（浏览器中）</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> process<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#39;undefined&#39;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> __dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#39;undefined&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🎯-实际应用-同构代码" tabindex="-1"><a class="header-anchor" href="#🎯-实际应用-同构代码"><span>🎯 实际应用：同构代码</span></a></h2><h3 id="什么是同构代码" tabindex="-1"><a class="header-anchor" href="#什么是同构代码"><span>什么是同构代码？</span></a></h3><p><strong>同构（Isomorphic）代码</strong>：能在服务器端和客户端都运行的代码。</p><h3 id="编写同构代码的原则" tabindex="-1"><a class="header-anchor" href="#编写同构代码的原则"><span>编写同构代码的原则</span></a></h3><h4 id="_1-环境检查" tabindex="-1"><a class="header-anchor" href="#_1-环境检查"><span>1. 环境检查</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 检查是否在浏览器环境</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 浏览器端代码</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 检查是否在 Node.js 环境</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> process <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Node.js 端代码</span></span>
<span class="line">  <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-条件导入" tabindex="-1"><a class="header-anchor" href="#_2-条件导入"><span>2. 条件导入</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> storage<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  storage <span class="token operator">=</span> window<span class="token punctuation">.</span>localStorage<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 服务器端使用文件存储</span></span>
<span class="line">  storage <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">getItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* 读文件 */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">setItem</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* 写文件 */</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-生命周期钩子" tabindex="-1"><a class="header-anchor" href="#_3-生命周期钩子"><span>3. 生命周期钩子</span></a></h4><p>在 Vue/React 等框架中：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Vue</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 这个钩子只在浏览器端执行</span></span>
<span class="line">    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;scroll&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onScroll<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// React</span></span>
<span class="line"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 这个 effect 只在浏览器端执行</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;scroll&#39;</span><span class="token punctuation">,</span> onScroll<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="📊-对比总结" tabindex="-1"><a class="header-anchor" href="#📊-对比总结"><span>📊 对比总结</span></a></h2><h3 id="问题-vs-解决" tabindex="-1"><a class="header-anchor" href="#问题-vs-解决"><span>问题 vs 解决</span></a></h3><table><thead><tr><th>方面</th><th>问题代码</th><th>解决方案</th></tr></thead><tbody><tr><td><strong>代码</strong></td><td><code>window.runPSI = ...</code></td><td><code>if (typeof window !== &#39;undefined&#39;) { window.runPSI = ... }</code></td></tr><tr><td><strong>构建时</strong></td><td>❌ 报错：window is not defined</td><td>✅ 跳过，不执行</td></tr><tr><td><strong>运行时</strong></td><td>-</td><td>✅ 正常执行</td></tr><tr><td><strong>原理</strong></td><td>直接访问 window</td><td>先检查，再访问</td></tr></tbody></table><hr><h2 id="🔍-类比理解" tabindex="-1"><a class="header-anchor" href="#🔍-类比理解"><span>🔍 类比理解</span></a></h2><h3 id="类比1-检查门是否存在" tabindex="-1"><a class="header-anchor" href="#类比1-检查门是否存在"><span>类比1：检查门是否存在</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 错误的方式</span></span>
<span class="line"><span class="token function">打开门</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 如果门不存在，直接撞墙报错</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 正确的方式</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>门存在<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">打开门</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 只有门存在才尝试打开</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="类比2-检查工具是否可用" tabindex="-1"><a class="header-anchor" href="#类比2-检查工具是否可用"><span>类比2：检查工具是否可用</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 在厨房</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>有搅拌机<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">使用搅拌机</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 在户外</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>有搅拌机<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 户外没有搅拌机，这段代码不执行</span></span>
<span class="line">  <span class="token function">使用搅拌机</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="💡-扩展知识" tabindex="-1"><a class="header-anchor" href="#💡-扩展知识"><span>💡 扩展知识</span></a></h2><h3 id="_1-其他需要检查的全局对象" tabindex="-1"><a class="header-anchor" href="#_1-其他需要检查的全局对象"><span>1. 其他需要检查的全局对象</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 检查 document</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> document <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 检查 localStorage</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> localStorage <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;value&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 检查 navigator</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> navigator <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-检查是否在-node-js-环境" tabindex="-1"><a class="header-anchor" href="#_2-检查是否在-node-js-环境"><span>2. 检查是否在 Node.js 环境</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 方法1：检查 process</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> process <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>versions <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;在 Node.js 环境&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 方法2：检查 window</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;不在浏览器环境，可能在 Node.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-更精确的环境检测" tabindex="-1"><a class="header-anchor" href="#_3-更精确的环境检测"><span>3. 更精确的环境检测</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">isBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> document <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">isNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">typeof</span> process <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span> <span class="token operator">&amp;&amp;</span> </span>
<span class="line">         process<span class="token punctuation">.</span>versions <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> </span>
<span class="line">         process<span class="token punctuation">.</span>versions<span class="token punctuation">.</span>node <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;在浏览器中&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;在 Node.js 中&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🎓-技术术语" tabindex="-1"><a class="header-anchor" href="#🎓-技术术语"><span>🎓 技术术语</span></a></h2><h3 id="ssr-vs-csr-vs-ssg" tabindex="-1"><a class="header-anchor" href="#ssr-vs-csr-vs-ssg"><span>SSR vs CSR vs SSG</span></a></h3><table><thead><tr><th>类型</th><th>全称</th><th>渲染时机</th><th>特点</th></tr></thead><tbody><tr><td><strong>SSR</strong></td><td>Server-Side Rendering</td><td>每次请求时</td><td>动态生成，SEO 好</td></tr><tr><td><strong>CSR</strong></td><td>Client-Side Rendering</td><td>浏览器端</td><td>单页应用，交互好</td></tr><tr><td><strong>SSG</strong></td><td>Static Site Generation</td><td>构建时</td><td>预渲染，速度快</td></tr></tbody></table><p>VuePress 使用的是 <strong>SSG</strong>（静态站点生成）：</p><ul><li>构建时用 SSR 生成 HTML</li><li>运行时用 CSR 激活交互</li></ul><hr><h2 id="✅-最佳实践" tabindex="-1"><a class="header-anchor" href="#✅-最佳实践"><span>✅ 最佳实践</span></a></h2><h3 id="在-vuepress-中使用-javascript-的模板" tabindex="-1"><a class="header-anchor" href="#在-vuepress-中使用-javascript-的模板"><span>在 VuePress 中使用 JavaScript 的模板</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ====================================</span></span>
<span class="line">  <span class="token comment">// 所有需要浏览器 API 的代码都放这里</span></span>
<span class="line">  <span class="token comment">// ====================================</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 全局函数</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 使用 DOM API</span></span>
<span class="line">    <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 使用 Web API</span></span>
<span class="line">    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;value&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 使用浏览器 crypto</span></span>
<span class="line">    crypto<span class="token punctuation">.</span>subtle<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">&#39;SHA-256&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 事件监听</span></span>
<span class="line">  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;DOMContentLoaded&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 初始化代码</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 定时器</span></span>
<span class="line">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 延迟执行的代码</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="🎯-总结" tabindex="-1"><a class="header-anchor" href="#🎯-总结"><span>🎯 总结</span></a></h2><h3 id="核心原理" tabindex="-1"><a class="header-anchor" href="#核心原理"><span>核心原理</span></a></h3><ol><li><strong>VuePress 在构建时使用 Node.js 执行代码</strong></li><li><strong>Node.js 没有 <code>window</code>、<code>document</code> 等浏览器对象</strong></li><li><strong><code>typeof</code> 可以安全检查未定义的变量</strong></li><li><strong>环境检查让代码&quot;聪明地&quot;跳过不兼容的部分</strong></li></ol><h3 id="工作流程" tabindex="-1"><a class="header-anchor" href="#工作流程"><span>工作流程</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">构建时（Node.js）</span>
<span class="line">  ↓</span>
<span class="line">检查：typeof window !== &#39;undefined&#39;</span>
<span class="line">  ↓</span>
<span class="line">结果：false（window 不存在）</span>
<span class="line">  ↓</span>
<span class="line">跳过 if 块内的代码</span>
<span class="line">  ↓</span>
<span class="line">构建成功，生成 HTML</span>
<span class="line">  ↓</span>
<span class="line">部署到服务器</span>
<span class="line">  ↓</span>
<span class="line">用户访问（浏览器）</span>
<span class="line">  ↓</span>
<span class="line">检查：typeof window !== &#39;undefined&#39;</span>
<span class="line">  ↓</span>
<span class="line">结果：true（window 存在）</span>
<span class="line">  ↓</span>
<span class="line">执行 if 块内的代码</span>
<span class="line">  ↓</span>
<span class="line">功能正常工作</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一句话总结" tabindex="-1"><a class="header-anchor" href="#一句话总结"><span>一句话总结</span></a></h3><p><strong>通过 <code>typeof window !== &#39;undefined&#39;</code> 检查，让代码在 Node.js 环境（构建时）跳过执行，在浏览器环境（运行时）正常执行，从而避免 SSR 报错。</strong></p><hr><h2 id="🤓-彩蛋-这不是-环境变量" tabindex="-1"><a class="header-anchor" href="#🤓-彩蛋-这不是-环境变量"><span>🤓 彩蛋：这不是&quot;环境变量&quot;</span></a></h2><h3 id="严格来说" tabindex="-1"><a class="header-anchor" href="#严格来说"><span>严格来说</span></a></h3><ul><li><strong>环境变量（Environment Variable）</strong>：系统级的配置变量，如 <code>process.env.NODE_ENV</code></li><li><strong>环境检查（Environment Check）</strong>：运行时判断当前在什么环境</li></ul><p>我们用的是<strong>环境检查</strong>，不是设置环境变量。</p><h3 id="真正的环境变量" tabindex="-1"><a class="header-anchor" href="#真正的环境变量"><span>真正的环境变量</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 读取环境变量（Node.js）</span></span>
<span class="line"><span class="token keyword">const</span> mode <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;生产环境&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;开发环境&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="我们用的环境检查" tabindex="-1"><a class="header-anchor" href="#我们用的环境检查"><span>我们用的环境检查</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 检查运行环境</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;浏览器环境&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Node.js 环境&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>希望这个详细的解释能帮你理解！🎉</p><p><strong>核心要点</strong>：</p><ul><li>VuePress 构建时在 Node.js 中运行代码</li><li>Node.js 没有 <code>window</code> 对象</li><li><code>typeof</code> 可以安全检查未定义的变量</li><li>环境检查让代码跳过不兼容的环境</li></ul><p><strong>简单记忆</strong>：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 只在浏览器中运行的代码</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这一行代码 = &quot;如果在浏览器里，才执行下面的代码&quot;</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2025-10-30T05:46:01.000Z" data-allow-mismatch>2025/10/30 13:46</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: tailunyu@example.com">tailunyu</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/secretflow-demo/devlog/tech-principles/PSI%E5%AF%86%E7%A0%81%E5%AD%A6%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3.html" aria-label="PSI 密码学技术详解"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">PSI 密码学技术详解</span></div><!--]--></a><a class="route-link auto-link next" href="/secretflow-demo/devlog/tech-principles/%E4%BB%8E%E5%9F%9F%E5%90%8D%E5%88%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%8C%E6%95%B4%E9%93%BE%E8%B7%AF.html" aria-label="从域名到文件的完整链路"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">从域名到文件的完整链路</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/secretflow-demo/assets/app-B3w0Vqk4.js" defer></script>
  </body>
</html>
